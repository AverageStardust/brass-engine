// library : Brass Engine
// version : 0.16.0dev
// author  : WD_STEVE
// required: p5
// optional: p5.sound, matter.js, regl.js
var Brass=function(t,e){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(e),n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)};
/******************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
/* global Reflect, Promise */function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function a(t,e,i,r){return new(i||(i=Promise))((function(n,o){function a(t){try{h(r.next(t))}catch(t){o(t)}}function s(t){try{h(r.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}h((r=r.apply(t,e||[])).next())}))}function s(t,e){var i,r,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function h(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,o=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}function u(t,e,i){if(i||2===arguments.length)for(var r,n=0,o=e.length;n<o;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}var c={any:Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,float32:Float32Array,float64:Float64Array};function d(t,e){if(void 0===e&&(e="Assertion failed"),!t)throw Error(e)}function f(t,e){void 0===e&&(e="Expectation failed"),t||console.error(e)}function p(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return color.apply(void 0,u([],l(t),!1))}function y(t,e,i,r){return new v(t,e,i,r)}var v=function(t){function e(e,i,n,o){void 0===n&&(n=P2D);var a=this,s=document.createElement("canvas");return(a=t.call(this,s,o)||this)._glAttributes={},function(t,e){for(var i in t.pInst=null!=e?e:window,r.default.prototype)t[i]||("function"==typeof r.default.prototype[i]?t[i]=r.default.prototype[i].bind(t):t[i]=r.default.prototype[i]);r.default.prototype._initializeInstanceVariables.apply(t)}(a,o),a.canvas=s,a.width=e,a.height=i,a._pixelDensity=a.pInst.pixelDensity(),n===WEBGL?a._renderer=new r.default.RendererGL(a.canvas,a,!1):a._renderer=new r.default.Renderer2D(a.canvas,a,!1),a._renderer.resize(e,i),a._renderer._applyDefaults(),a}return o(e,t),e.prototype.reset=function(){this._renderer.resetMatrix(),this._renderer.isP3D&&this._renderer._update()},e.prototype.remove=function(){for(var t in this._events)this.elt.removeEventListener(t,this._events[t])},e}(r.default.Element);var g=function(){function t(t,e,i,r){this.pool=Array(t).fill(null).map(i),this.limited=e,this.generator=i,this.cleaner=null!=r?r:function(t){return t}}return t.prototype.get=function(){if(this.pool.length<=0){if(this.limited)throw Error("Limited pool ran out of objects");return this.generator()}return this.cleaner(this.pool.pop())},t.prototype.release=function(t){this.pool.push(t)},Object.defineProperty(t.prototype,"size",{get:function(){return this.pool.length},enumerable:!1,configurable:!0}),t}(),m=function(){function t(t,e){if(void 0===t&&(t=[]),void 0===e)throw Error("Heap was expecting a compare function");return this.data=t,this.compare=e,this.data.length>1&&this.sort(),this}return t.prototype.insert=function(t){return this.data.push(t),this.siftUp(this.size-1),this},t.prototype.remove=function(t){if(void 0===t&&(t=0),0!==this.size){if(1===this.size)return this.data.pop();if(!(this.data.length<=t)){this.swap(t,this.data.length-1);var e=this.data.pop();return this.siftDown(t),e}}},t.prototype.top=function(){return this.data[0]},t.prototype.sort=function(){for(var t=this.size-1;t>=0;t--)this.siftDown(t);return this},t.prototype.log=function(){for(var t="Â ",e=Math.floor(Math.log2(this.size)+1),i=4*Math.pow(2,e-1)-1,r=[],n=0,o=0;n<e;n++){for(var a=Math.pow(2,n),s=t.repeat(2*(Math.pow(2,e-n-1)-1)),h=s,l=0;l<a;l++){var u=String(this.data[o]).substr(0,3);if(3===u.length?s+=u:2===u.length?s+=t+u:1===u.length?s+=t+u+t:s+="???",h+=l%2?"\\"+t.repeat(2):t.repeat(2)+"/",++o>=this.size)break;if(l+1<a){var c=t.repeat(2*(Math.pow(2,e-n)-1)-1);s+=c,h+=c}}n>0&&r.push(h.padEnd(i,t)),r.push(s.padEnd(i,t))}return console.log(r.join("\n")),this},t.prototype.siftUp=function(t){if(0===t)return this;var e=this.parent(t);return this.compare(this.data[t],this.data[e])?(this.swap(t,e).siftUp(e),this):this},t.prototype.siftDown=function(t){var e=this.childLeft(t),i=this.childRight(t);return i>=this.size?(e<this.size&&this.compare(this.data[e],this.data[t])&&this.swap(t,e),this):(this.compare(this.data[e],this.data[i])?this.compare(this.data[e],this.data[t])&&this.swap(t,e).siftDown(e):this.compare(this.data[i],this.data[t])&&this.swap(t,i).siftDown(i),this)},t.prototype.parent=function(t){return t-1>>1},t.prototype.childLeft=function(t){return 1+(t<<1)},t.prototype.childRight=function(t){return 2+(t<<1)},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.length},enumerable:!1,configurable:!0}),t}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.swap=function(t,e){var i=this.data[t];return this.data[t]=this.data[e],this.data[e]=i,this},e}(m),b=function(t){function e(e,i){void 0===e&&(e=[]);var r=t.call(this,[],i)||this;r.map=new Map;for(var n=0;n<r.data.length;n++)r.map.set(r.data[n],n);return r.data=e,r.data.length>1&&r.sort(),r}return o(e,t),e.prototype.insert=function(e){return void 0!==this.map.get(e)&&this.removeValue(e),this.map.set(e,this.data.length),t.prototype.insert.call(this,e),this},e.prototype.removeValue=function(e){var i=this.map.get(e);if(void 0!==i)return t.prototype.remove.call(this,i),this.map.delete(e),e},e.prototype.swap=function(t,e){var i=this.data[t],r=this.data[e];return this.data[t]=r,this.map.set(r,t),this.data[e]=i,this.map.set(i,e),this},e}(m),x=function(t){function e(e){return t.call(this,e,(function(t,e){return t>e}))||this}return o(e,t),e}(w),S=function(t){function e(e){return t.call(this,e,(function(t,e){return t<e}))||this}return o(e,t),e}(w),C=function(t){function e(e){return t.call(this,e,(function(t,e){return t>e}))||this}return o(e,t),e}(b),M=function(t){function e(e){return t.call(this,e,(function(t,e){return t<e}))||this}return o(e,t),e}(b);function k(t,e){var i,r=T(t);return"any"===t?new((i=r).bind.apply(i,u([void 0],l(e),!1))):new r(e)}function z(t){for(var e=new Uint8Array(t.buffer),i=[],r=0;r<e.byteLength;r++)i.push(String.fromCharCode(e[r]));return btoa(i.join(""))}function P(t,e){for(var i=window.atob(e),r=new Uint8Array(i.length),n=0;n<r.byteLength;n++)r[n]=i.charCodeAt(n);return function(t,e){return new(T(t))(e)}(t,r.buffer)}function T(t){var e=c[t];if(void 0===e)throw Error("Can't find type (".concat(t,") array constructor"));return e}var E=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.fromObj=function(e){if("number"!=typeof e.x||"number"!=typeof e.y)throw Error("Object can't be transformed into Vector2 without numeric x and y properties");return new t(e.x,e.y)},t.fromObjFast=function(e){return new t(e.x,e.y)},t.fromDir=function(e){return new t(Math.cos(e),Math.sin(e))},t.fromDirMag=function(e,i){return new t(i*Math.cos(e),i*Math.sin(e))},t.prototype.copy=function(){return new t(this.x,this.y)},t.prototype.equal=function(t){return this.x===t.x&&this.y===t.y},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.setScalar=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addScalar=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x+=t,this.y+=e,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.subScalar=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this},t.prototype.mult=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.multScalar=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),this.x*=t,this.y*=e,this},t.prototype.div=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.divScalar=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),this.x/=t,this.y/=e,this},t.prototype.rem=function(t){return this.x%=t.x,this.y%=t.y,this},t.prototype.remScalar=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),this.x%=t,this.y%=e,this},t.prototype.mod=function(t){return this.x=(this.x%t.x+t.x)%t.x,this.y=(this.y%t.y+t.y)%t.y,this},t.prototype.modScalar=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),this.x=(this.x%t+t)%t,this.y=(this.y%e+e)%e,this},t.prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},t.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.prototype.mix=function(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this},t.prototype.norm=function(t){void 0===t&&(t=1);var e=this.mag;if(0===e)return this;var i=t/e;return this.x*=i,this.y*=i,this},t.prototype.normArea=function(t){void 0===t&&(t=1);var e=this.area;if(0===e)return this;var i=Math.sqrt(t/e);return this.x*=i,this.y*=i,this},t.prototype.limit=function(t){return void 0===t&&(t=1),this.mag>t&&this.norm(t),this},t.prototype.setAngle=function(t){var e=this.mag;return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.x*e-this.y*i;return this.y=this.x*i+this.y*e,this.x=r,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){var e=t.y*this.x-t.x-this.y,i=this.x*t.y+this.y*t.y;return Math.atan(e/i)},t.prototype.dist=function(t){return Math.hypot(this.x-t.x,this.y-t.y)},t.prototype.distSq=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},Object.defineProperty(t.prototype,"mag",{get:function(){return Math.hypot(this.x,this.y)},set:function(t){this.norm(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"magSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.x*this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return Math.atan2(this.y,this.x)},set:function(t){this.setAngle(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"array",{get:function(){return[this.x,this.y]},set:function(t){this.x=t[0],this.y=t[1]},enumerable:!1,configurable:!0}),t}(),A=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=e),this.x=t,this.y=e,this.z=i}return t.fromObj=function(e){if("number"!=typeof e.x||"number"!=typeof e.y||"number"!=typeof e.z)throw Error("Object can't be transformed into Vector3 without numeric x, y and z properties");return new t(e.x,e.y,e.z)},t.fromObjFast=function(e){return new t(e.x,e.y,e.z)},t.prototype.copy=function(){return new t(this.x,this.y,this.z)},t.prototype.equal=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.setScalar=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=e),this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.addScalar=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=e),this.x+=t,this.y+=e,this.z+=i,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.subScalar=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=e),this.x-=t,this.y-=e,this.z-=i,this},t.prototype.mult=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.multScalar=function(t,e,i){return void 0===t&&(t=1),void 0===e&&(e=t),void 0===i&&(i=e),this.x*=t,this.y*=e,this.z*=i,this},t.prototype.div=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},t.prototype.divScalar=function(t,e,i){return void 0===t&&(t=1),void 0===e&&(e=t),void 0===i&&(i=e),this.x/=t,this.y/=e,this.z/=i,this},t.prototype.rem=function(t){return this.x%=t.x,this.y%=t.y,this.z%=t.z,this},t.prototype.remScalar=function(t,e,i){return void 0===t&&(t=1),void 0===e&&(e=t),void 0===i&&(i=e),this.x%=t,this.y%=e,this.z%=i,this},t.prototype.mod=function(t){return this.x=(this.x%t.x+t.x)%t.x,this.y=(this.y%t.y+t.y)%t.y,this.z=(this.z%t.z+t.z)%t.z,this},t.prototype.modScalar=function(t,e,i){return void 0===t&&(t=1),void 0===e&&(e=t),void 0===i&&(i=e),this.x=(this.x%t+t)%t,this.y=(this.y%e+e)%e,this.z=(this.z%i+i)%i,this},t.prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},t.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},t.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},t.prototype.mix=function(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.y-this.z)*e,this},t.prototype.norm=function(t){void 0===t&&(t=1);var e=this.mag;if(0===e)return this;var i=t/e;return this.x*=i,this.y*=i,this.z*=i,this},t.prototype.limit=function(t){return void 0===t&&(t=1),this.mag>t&&this.norm(t),this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.cross=function(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x,this},t.prototype.dist=function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+i*i+r*r)},t.prototype.distSq=function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r},Object.defineProperty(t.prototype,"xy",{get:function(){return new E(this.x,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yx",{get:function(){return new E(this.y,this.x)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yz",{get:function(){return new E(this.y,this.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zy",{get:function(){return new E(this.z,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xz",{get:function(){return new E(this.x,this.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zx",{get:function(){return new E(this.z,this.x)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return new t(this.x,this.y,this.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yxz",{get:function(){return new t(this.y,this.x,this.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yzx",{get:function(){return new t(this.y,this.z,this.x)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zyx",{get:function(){return new t(this.z,this.y,this.x)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xzy",{get:function(){return new t(this.x,this.z,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zxy",{get:function(){return new t(this.z,this.x,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mag",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},set:function(t){this.norm(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"magSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"array",{get:function(){return[this.x,this.y,this.z]},set:function(t){this.x=t[0],this.y=t[1],this.z=t[2]},enumerable:!1,configurable:!0}),t}();function D(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.x,n=this.y,o=this.z,a=t.call.apply(t,u([this],l(e),!1));return this.x===r&&this.y===n&&this.z===o||this.watcher(this),a}var L={get:function(t,e){var i=Reflect.get(t,e);return"function"==typeof i?D.bind(t,i):i},set:function(t,e,i){return!!Reflect.set(t,e,i)&&(t.watcher(t),!0)}};function B(t,e){return t.watcher=e,new Proxy(t,L)}var R=new Map,j=[],O=new Map,F=[];function I(t){var e,i,r=t.gamepad;if("standard"===r.mapping){try{for(var n=h(F),o=n.next();!o.done;o=n.next()){var a=o.value;if(a.user){if(!a.gamepad)return a.gamepad=r,void(a.user.gamepad=r);if(r.index===a.gamepad.index)return a.gamepad=r,void(a.user.gamepad=r)}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}F.push({gamepad:t.gamepad,user:null})}else alert("Browser couldn't find standard mapping for gamepad, it has been ignored.")}function _(t){var e,i,r=t.gamepad;try{for(var n=h(F),o=n.next();!o.done;o=n.next()){var a=o.value;if(a.gamepad&&a.user&&r.index===a.gamepad.index)return void(a.user.gamepad=null)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}}function W(t){var e=R.get(t);if(e)return e;switch(t){default:if(!t.startsWith("gamepad"))throw Error("Unknown input device (".concat(t,")"));e=new Y;break;case"keyboard":e=new V;break;case"mouse":e=new X}return R.set(t,e),e}var N,U=function(){function t(t,e,i,r){var n,o,a,s,l,u;this.buttonStateChanges=new Map,this.axisStateChanges=new Map,this.vectorStateChanges=new Map,this.buttonState=new Map,this.axisState=new Map,this.vectorState=new Map,this.devicePrefix=t;try{for(var c=h(e),d=c.next();!d.done;d=c.next()){var f=d.value;this.buttonState.set(f,!1)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}try{for(var p=h(i),y=p.next();!y.done;y=p.next()){var v=y.value;this.axisState.set(v,0)}}catch(t){a={error:t}}finally{try{y&&!y.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}try{for(var g=h(r),m=g.next();!m.done;m=g.next()){v=m.value;this.vectorState.set(v,new E(0,0))}}catch(t){l={error:t}}finally{try{m&&!m.done&&(u=g.return)&&u.call(g)}finally{if(l)throw l.error}}}return t.prototype.applyState=function(t){var e,i,r,n,o,a;try{for(var s=h(this.buttonState.entries()),u=s.next();!u.done;u=s.next()){var c=l(u.value,2),d=c[0],f=c[1];t.button.add(this.devicePrefix+d,f)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}try{for(var p=h(this.axisState.entries()),y=p.next();!y.done;y=p.next()){var v=l(y.value,2),g=v[0];f=v[1];t.axis.add(this.devicePrefix+g,f)}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}try{for(var m=h(this.vectorState.entries()),w=m.next();!w.done;w=m.next()){var b=l(w.value,2),x=b[0];f=b[1];t.vector.add(this.devicePrefix+x,f)}}catch(t){o={error:t}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}},t.prototype.applyStateChange=function(t){var e,i,r,n,o,a;try{for(var s=h(this.buttonStateChanges.entries()),u=s.next();!u.done;u=s.next()){var c=l(u.value,2),d=c[0],f=c[1];t.button.set(this.devicePrefix+d,f)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}this.buttonStateChanges.clear();try{for(var p=h(this.axisStateChanges.entries()),y=p.next();!y.done;y=p.next()){var v=l(y.value,2),g=v[0];f=v[1];t.axis.set(this.devicePrefix+g,f)}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}this.axisStateChanges.clear();try{for(var m=h(this.vectorStateChanges.entries()),w=m.next();!w.done;w=m.next()){var b=l(w.value,2),x=b[0];f=b[1];t.vector.set(this.devicePrefix+x,f)}}catch(t){o={error:t}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}this.vectorStateChanges.clear()},t.prototype.clearState=function(){var t,e,i,r,n,o;try{for(var a=h(this.buttonState.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;this.setButton(l,!1)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}try{for(var u=h(this.axisState.keys()),c=u.next();!c.done;c=u.next()){var d=c.value;this.setAxis(d,0)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(i)throw i.error}}try{for(var f=h(this.vectorState.keys()),p=f.next();!p.done;p=f.next()){var y=p.value;this.setVector(y,{x:0,y:0})}}catch(t){n={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}},t.prototype.setButton=function(t,e){this.buttonState.has(t)&&this.buttonState.get(t)!==e&&(this.buttonState.set(t,e),this.buttonStateChanges.set(t,e))},t.prototype.setAxis=function(t,e){this.axisState.has(t)&&this.axisState.get(t)!==e&&(this.axisState.set(t,e),this.axisStateChanges.set(t,e))},t.prototype.setVector=function(t,e){if(this.vectorState.has(t)){var i=E.fromObjFast(e);i.equal(this.vectorState.get(t))||(this.vectorState.set(t,i),this.vectorStateChanges.set(t,i))}},t}(),V=function(t){function e(){var e=t.call(this,"keyboard",["A","AltLeft","AltRight","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","B","Backspace","Backquote","Backslash","BracketLeft","BracketRight","C","Comma","ControlLeft","ControlRight","D","Delete","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","E","Enter","Equal","Escape","F","F1","F10","F11","F12","F2","F3","F4","F5","F6","F7","F8","F9","G","H","I","J","K","L","M","MetaLeft","MetaRight","Minus","N","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadDecimal","NumpadDivide","NumpadEnter","NumpadMultiply","NumpadSubtract","O","P","Period","Q","Quote","R","S","Semicolon","ShiftLeft","ShiftRight","Slash","Space","T","U","V","W","X","Y","Z"],[],[])||this;return window.addEventListener("keydown",e.handleKeyListener.bind(e,!0)),window.addEventListener("keyup",e.handleKeyListener.bind(e,!1)),e}return o(e,t),e.prototype.update=function(){},e.prototype.handleKeyListener=function(t,e){var i=e.code;i.startsWith("Key")&&(i=i.substring(3,1/0)),this.setButton(i,t)},e}(U),X=function(t){function e(){var e=t.call(this,"mouse",["Left","Center","Right"],[],[])||this;return window.addEventListener("mousedown",e.handleKeyListener.bind(e,!0)),window.addEventListener("mouseup",e.handleKeyListener.bind(e,!1)),e}return o(e,t),e.prototype.update=function(){},e.prototype.handleKeyListener=function(t,e){switch(e.button){case 0:this.setButton("Left",t);break;case 1:this.setButton("Center",t),e.preventDefault();break;case 2:this.setButton("Right",t)}},e}(U),Y=function(t){function e(){var e,i,r=t.call(this,"gamepad",["DpadDown","DpadLeft","DpadRight","DpadUp","FaceDown","FaceLeft","FaceRight","FaceUp","ControlLeft","ControlRight","ShoulderLeft","ShoulderRight","TriggerLeft","TriggerRight","StickLeft","StickRight","Meta"],["ShoulderLeft","ShoulderRight","TriggerLeft","TriggerRight"],["StickLeft","StickRight"])||this;r.deadZone=.1;try{for(var n=h(F),o=n.next();!o.done;o=n.next()){var a=o.value;if(!a.user&&a.gamepad)return a.user=r,r.gamepad=a.gamepad,r}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return F.push({gamepad:null,user:r}),r.gamepad=null,r}return o(e,t),e.prototype.update=function(){if(this.gamepad){var t=this.gamepad.buttons;this.setButton("DpadDown",t[13].pressed),this.setButton("DpadLeft",t[14].pressed),this.setButton("DpadRight",t[15].pressed),this.setButton("DpadUp",t[12].pressed),this.setButton("FaceDown",t[0].pressed),this.setButton("FaceLeft",t[2].pressed),this.setButton("FaceRight",t[1].pressed),this.setButton("FaceUp",t[3].pressed),this.setButton("ControlLeft",t[8].pressed),this.setButton("ControlRight",t[9].pressed),this.setButton("ShoulderLeft",t[4].pressed),this.setButton("ShoulderRight",t[5].pressed),this.setButton("TriggerLeft",t[6].pressed),this.setButton("TriggerRight",t[7].pressed),this.setButton("StickLeft",t[10].pressed),this.setButton("StickRight",t[11].pressed),this.setButton("Meta",t[16].pressed),this.setAxis("ShoulderLeft",t[4].value),this.setAxis("ShoulderRight",t[5].value),this.setAxis("TriggerLeft",t[6].value),this.setAxis("TriggerRight",t[7].value);var e=this.gamepad.axes,i=new E(e[0],e[1]),r=new E(e[2],e[3]);this.processStick(i),this.processStick(r),this.setVector("StickLeft",i),this.setVector("StickRight",r)}else this.clearState()},e.prototype.processStick=function(t){if(0!==t.mag){var e,i=Math.abs(t.x),r=Math.abs(t.y);e=i>r?t.copy().divScalar(i):t.copy().divScalar(r),t.divScalar(e.mag),t.mag<this.deadZone&&t.setScalar(0,0)}},e}(U),G=function(){function t(t){this.state=new Map,this.unitName=t}return t.prototype.has=function(t){return this.state.has(t)},t.prototype.get=function(t){return d(this.state.has(t),"Can't get unknown ".concat(this.unitName," (").concat(t,")")),this.state.get(t)},t.prototype.setSafe=function(t,e){this.state.has(t)?this.set(t,e):this.add(t,e)},t.prototype.set=function(t,e){d(this.state.has(t),"Can't set unknown ".concat(this.unitName," (").concat(t,")")),this.state.set(t,e)},t.prototype.add=function(t,e){this.state.set(t,e)},t}(),q=function(t){function e(e){var i=t.call(this,e)||this;return i.unions=new Map,i.nextResolves=[],i}return o(e,t),e.prototype.update=function(){var t,e;try{for(var i=h(this.unions.keys()),r=i.next();!r.done;r=i.next()){var n=r.value;this.updateUnion(n)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype.setSafe=function(t,e){this.state.has(t)?this.set(t,e):this.add(t,e)},e.prototype.set=function(t,e){if((d(this.state.has(t),"Can't set unknown ".concat(this.unitName)),e)&&!this.state.get(t)){var i=this.nextResolves.shift();i&&i(t)}this.state.set(t,e)},e.prototype.next=function(){return a(this,void 0,void 0,(function(){var t=this;return s(this,(function(e){return[2,new Promise((function(e){t.nextResolves.push(e)}))]}))}))},e.prototype.updateUnion=function(t){var e=this,i=this.unions.get(t),r=Object.fromEntries(i.map((function(t){return[t,e.state.get(t)]})));this.set(t,this.joinUnion(r))},e.prototype.joinUnion=function(t){var e=Object.values(t);return 0!==e.length&&e.reduce((function(t,e){return t&&e}))},e.prototype.setAvailableUnion=function(t,e){var i,r,n=[];try{for(var o=h(e),a=o.next();!a.done;a=o.next()){var s=a.value;this.has(s)&&n.push(s)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}this.setUnion(t,n)},e.prototype.setUnion=function(t,e){var i,r;try{for(var n=h(e),o=n.next();!o.done;o=n.next()){var a=o.value;d(this.state.has(a),"Can't make union with unknown ".concat(this.unitName)),d(this.unions.has(a),"Can't make union with union ".concat(this.unitName))}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}this.unions.set(t,e),this.add(t,void 0),this.updateUnion(t)},e}(G),H=function(){function t(t,e){var i,r,n,o,a,s;void 0===t&&(t=["keyboard","mouse","gamepad"]),this.button=new q("button"),this.axis=new G("axis"),this.vector=new G("vector"),this.devices=[],this.derivers=[];try{for(var l=h(t),u=l.next();!u.done;u=l.next()){var c=W(u.value);this.devices.push(c),c.applyState(this)}}catch(t){i={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(i)throw i.error}}e||(e=["movement","actionA","actionB","actionC"]);try{for(var d=h(e),f=d.next();!f.done;f=d.next()){if("function"==typeof(g=f.value))this.derivers.push(g);else{var p=O.get(g);if(!p)throw Error("Can't find input deriver named (".concat(g,")"));this.derivers.push(p)}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}try{for(var y=h(this.derivers),v=y.next();!v.done;v=y.next()){var g;(g=v.value)(this)}}catch(t){a={error:t}}finally{try{v&&!v.done&&(s=y.return)&&s.call(y)}finally{if(a)throw a.error}}j.push(this)}return t.prototype.update=function(){var t,e,i,r;try{for(var n=h(this.devices),o=n.next();!o.done;o=n.next()){o.value.applyStateChange(this)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.button.update();try{for(var a=h(this.derivers),s=a.next();!s.done;s=a.next()){(0,s.value)(this)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}},t.prototype.has=function(t){var e,i;try{for(var r=h(this.devices),n=r.next();!n.done;n=r.next()){if(n.value.devicePrefix===t)return!0}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return!1},t}(),K=new Map,Q=null,J=!1;function Z(t,e,i){if(N=t,function(t){if(void 0===t){N.createCanvas(windowWidth,windowHeight);var e=new yt((function(){return{x:N.width,y:N.height}}),N);$("default",e),$("defaultP5",e)}else if(noCanvas(),t instanceof ft)$("default",t),t instanceof yt&&$("defaultP5",t),t instanceof vt&&$("defaultRegl",t);else{if(!(t instanceof r.default.Graphics))throw Error("Can't make default drawTarget in Brass.init(), bad value");var i=new yt((function(){return{x:t.width,y:t.height}}),t);$("default",i),$("defaultP5",i)}}(i),et("default")){ot();var n=tt("default");if(function(t){var e;t instanceof yt&&(e=t.getMaps().canvas.canvas);t instanceof vt&&(e=t.getMaps().canvas);if(e){if(N._userNode)N._userNode.appendChild(e);else{if(0===document.getElementsByTagName("main").length){var i=document.createElement("main");document.body.appendChild(i)}document.getElementsByTagName("main")[0].appendChild(e)}return e.style.display="block",!0}}(n),e){var o=n.getMaps().canvas;Q=createREGL({canvas:o})}}}function $(t,e){if(et(t))throw Error("Can't overwrite (".concat(t,") DrawTarget"));K.set(t,e)}function tt(t){var e=K.get(t);if(void 0===e)throw Error("Could not find (".concat(t,") DrawTarget; Maybe create one or run Brass.init() with drawTarget enabled"));return e}var et=K.has.bind(K);function it(t){var e=tt(t);if(!(e instanceof yt))throw Error("Could not find (".concat(t,") P5DrawTarget; DrawTarget under that name is not of subclass P5DrawTarget"));return e}function rt(t){var e=tt(t);if(!(e instanceof vt))throw Error("Could not find (".concat(t,") CanvasDrawTarget; DrawTarget under that name is not of subclass CanvasDrawTarget"));return e}function nt(t,e){tt("default").refresh(),ot(),ht()}function ot(){if(et("defaultP5")){var t=tt("defaultP5").getMaps().canvas;t.resetMatrix(),N.width=t.width,N.height=t.height}}function at(){return d(null!==Q,"Could not access regl; Include regl.js and enable it in Brass.init() first"),Q}function st(){at(),J||(J=!0,queueMicrotask(ht))}function ht(){J&&(at()._refresh(),J=!1)}var lt,ut,ct=function(){function t(t,e){void 0===e&&(e=t),this.id=Symbol(),this.creator=t,this.resizer=e,this.setMaps(null)}return t.prototype.hasSize=function(){return null!==this.size},t.prototype.getSize=function(t){return void 0===t&&(t=1),null===this.size&&this.throwSizeError(),{x:this.size.x*t,y:this.size.y*t}},t.prototype.sizeMaps=function(t){if(null===this.size)this.setMaps(this.creator(t));else{if(this.size.x===t.x&&this.size.y===t.y)return;this.setMaps(this.resizer(t,this.maps))}this.size=t},t.prototype.hasName=function(t){return!!et(t)&&tt(t).id===this.id},t.prototype.setMaps=function(t){null===t?(this.maps,new Proxy({},{get:this.throwSizeError})):this.maps=new Proxy(t,{get:this.getMap.bind(this)})},t.prototype.getMap=function(t,e){if(!t.hasOwnProperty(e))throw Error("Can't get (".concat(e,") map in DrawTarget"));return t[e]},t.prototype.throwSizeError=function(){throw Error("Could not use DrawSurface, size has not been set")},t}(),dt=function(t){function e(e,i){void 0===i&&(i=e);var r=t.call(this,e,i)||this;return r.size=null,r}return o(e,t),e.prototype.getMaps=function(t){return void 0===t?null===this.size&&this.throwSizeError():this.sizeMaps(t),this.maps},e}(ct),ft=function(t){function e(e,i,r){void 0===i&&(i=e),void 0===r&&(r=gt);var n=t.call(this,e,i)||this;return n.sizer=r,n.size=n.getSizerResult(),n.setMaps(n.creator(n.size)),n}return o(e,t),e.prototype.setSizer=function(t){this.sizer=t,this.refresh()},e.prototype.getMaps=function(){return this.maps},e.prototype.refresh=function(t){var e,i,r,n;void 0===t&&(t=[]);var o=this.getSizerResult();if(void 0===this.size||this.size.x!==o.x||this.size.y!==o.y){try{for(var a=h(t),s=a.next();!s.done;s=a.next()){if(s.value===this.id)throw Error("Resize of DrawTarget caused itself to resize; Loop in sizer dependency chain")}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}this.sizeMaps(o);try{for(var l=h(K.values()),u=l.next();!u.done;u=l.next()){var c=u.value;c.id!==this.id&&c.refresh(t.concat(this.id))}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}},e.prototype.getSizerResult=function(){var t=this.sizer(this);return{x:Math.floor(t.x),y:Math.floor(t.y)}},e}(ct),pt=function(t){function e(e){return void 0===e&&(e=P2D),t.call(this,(function(t){var i=t.x,r=t.y;return"string"==typeof e?{canvas:y(i,r,e)}:(e.width===i&&e.height===r||e.resizeCanvas(i,r,!0),{canvas:e})}),(function(t,e){var i=t.x,r=t.y,n=e.canvas;return n.resizeCanvas(i,r,!0),{canvas:n}}))||this}return o(e,t),e}(dt),yt=function(t){function e(e,i){return void 0===e&&(e=gt),void 0===i&&(i=P2D),t.call(this,(function(t){var e=t.x,r=t.y;return"string"==typeof i?{canvas:y(e,r,i)}:(i.width===e&&i.height===r||i.resizeCanvas(e,r,!0),{canvas:i})}),(function(t,e){var i=t.x,r=t.y,n=e.canvas;return n.resizeCanvas(i,r,!0),{canvas:n}}),e)||this}return o(e,t),e}(ft),vt=function(t){function e(e){return void 0===e&&(e=gt),t.call(this,(function(t){var e=t.x,i=t.y,r=document.createElement("CANVAS");return r.width=e,r.height=i,{canvas:r}}),(function(t,e){var i=t.x,r=t.y,n=e.canvas;return n.width=i,n.height=r,st(),{canvas:n}}),e)||this}return o(e,t),e}(ft);function gt(t){return t.hasName("default")?{x:window.innerWidth,y:window.innerHeight}:tt("default").getSize()}!function(t){t.Image="image",t.Sound="sound",t.World="world"}(ut||(ut={}));var mt,wt,bt=((lt={})[ut.Image]=new Set([".png",".jpg",".jpeg",".gif",".tif",".tiff"]),lt[ut.Sound]=new Set([".mp3",".wav",".ogg"]),lt[ut.World]=new Set([".json"]),lt),xt={},St=[],Ct=!1,Mt=!1,kt=!1,zt=!1,Pt=0,Tt=0,Et=0;function At(t){if(!Mt)throw Error("Brass loader must be initialized before ".concat(t,"; Run Brass.init()"))}function Dt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];St.push.apply(St,u([],l(t),!1)),queueMicrotask(Lt)}function Lt(){var t=St.shift();if(Mt&&!(Tt>=2)&&(jt()&&(Pt=0,Et=0),void 0!==t)){switch(Tt++,t.type){default:throw Error("Unknown asset type (".concat(t.type,")"));case ut.Image:loadImage(t.path,Bt.bind(globalThis,t),Rt.bind(globalThis,t));break;case ut.Sound:loadSound(t.path,Bt.bind(globalThis,t),Rt.bind(globalThis,t));break;case ut.World:loadJSON(t.path,Bt.bind(globalThis,t),Rt.bind(globalThis,t))}queueMicrotask(Lt)}}function Bt(t,e){var i,r;t.late&&Et++,Tt--,t.type===ut.World&&(f(void 0!==t.fields),e=_t(t.fields,e));try{for(var n=h(t.names),o=n.next();!o.done;o=n.next()){var a=o.value;xt[a]=e}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}t.resolve&&t.resolve(e),"children"in t&&t.children.length>0?Dt.apply(void 0,u([],l(t.children),!1)):queueMicrotask(Lt)}function Rt(t){t.late&&Et++,Tt--;var e=Error("Failed to load asset (".concat(t.names[0],") at path (").concat(t.path,")"));if(!t.reject)throw e;t.reject(e)}function jt(){return Ot()>=1}function Ot(){return 0===Pt?1:Et/Pt}function Ft(t,e,i){void 0===i&&(i=!0);var r=t.pop();if(void 0===r)return{promises:[]};var n=Ft(t,e,!1),o=n.asset,a=n.promises,s=e.name,h=e.basePath,l=e.extension,u={type:ut.Image,path:h+r+l,names:[s,s+r],late:i,children:[]};return i&&Pt++,void 0!==o&&(u.children=[o]),a.push(new Promise((function(t,e){u.resolve=t,u.reject=e,i&&Dt(u)}))),{asset:u,promises:a}}function It(){if(!kt)try{var t=Array.from(bt[ut.Sound]).map((function(t){return t.replace(".","")}));soundFormats.apply(void 0,u([],l(t),!1)),kt=!0}catch(t){}}function _t(t,e){var i,r,n,o,a,s,u,c,d,f;if("map"!==e.type)throw Error('World file was not of type "map"');if(!zt){if(e.version<1.4)throw Error("World file version was not 1.4; Run enableUnsafeWorldLoading() to ignore this");if(!1!==e.infinite)throw Error("World file may be infinite; Run enableUnsafeWorldLoading() to ignore this");if("orthogonal"!==e.orientation)throw Error("World file was not orthogonal; Run enableUnsafeWorldLoading() to ignore this");if("right-down"!==e.renderorder)throw Error("World file was not rendered right down; Run enableUnsafeWorldLoading() to ignore this")}var p=l(Wt(e),2),y=p[0],v=p[1],g={width:e.width,height:e.height,objects:[],fields:{},tilesets:{}},m=function(e){var i=t[e];if("sparse"===i)throw Error("World file had sparse type in field declaration; This is not supported");var r=y.findIndex((function(t){return t.name===e}));if(-1===r)throw Error("World file did not have layer named (".concat(e,") like in the field decleration"));var n=y[r];if(!zt){if(""!==n.compression&&void 0!==n.compression)throw Error("World file has compression; Run enableUnsafeWorldLoading() to ignore this");if("base64"!==n.encoding&&void 0!==n.encoding)throw Error("World file has unknown encoding (".concat(n.encoding,"); Run enableUnsafeWorldLoading() to ignore this"))}"base64"===n.encoding?g.fields[e]={type:i,data:n.data,encoding:"uint32"}:g.fields[e]={type:i,data:n.data}};for(var w in t)m(w);if(v.length>0){if(v.length>1&&!zt)throw Error("World file had multiple object layers; Run enableUnsafeWorldLoading() to combine them");try{for(var b=h(v),x=b.next();!x.done;x=b.next()){var S=x.value;try{for(var C=(n=void 0,h(S.objects)),M=C.next();!M.done;M=C.next()){var k=M.value;g.objects.push(k)}}catch(t){n={error:t}}finally{try{M&&!M.done&&(o=C.return)&&o.call(C)}finally{if(n)throw n.error}}}}catch(t){i={error:t}}finally{try{x&&!x.done&&(r=b.return)&&r.call(b)}finally{if(i)throw i.error}}}try{for(var z=h(e.tilesets),P=z.next();!P.done;P=z.next()){var T=P.value,E=T.name;if(g.tilesets[E]={firstId:T.firstgid,tiles:{}},Array.isArray(T.tiles))try{for(var A=(u=void 0,h(T.tiles)),D=A.next();!D.done;D=A.next()){var L=D.value,B=L.id;if(g.tilesets[E].tiles[B]={},Array.isArray(L.properties))try{for(var R=(d=void 0,h(L.properties)),j=R.next();!j.done;j=R.next()){var O=j.value;g.tilesets[E].tiles[B][O.name]=O.value}}catch(t){d={error:t}}finally{try{j&&!j.done&&(f=R.return)&&f.call(R)}finally{if(d)throw d.error}}}}catch(t){u={error:t}}finally{try{D&&!D.done&&(c=A.return)&&c.call(A)}finally{if(u)throw u.error}}}}catch(t){a={error:t}}finally{try{P&&!P.done&&(s=z.return)&&s.call(z)}finally{if(a)throw a.error}}return g}function Wt(t){var e,i,r=[],n=[];if("map"===t.type||"group"===t.type)try{for(var o=h(t.layers),a=o.next();!a.done;a=o.next()){var s=l(Wt(a.value),2),c=s[0],d=s[1];r.push.apply(r,u([],l(c),!1)),n.push.apply(n,u([],l(d),!1))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}else if("tilelayer"===t.type)r.push(t);else if("objectgroup"===t.type)n.push(t);else if(!zt)throw Error("World file has unknown layer type (".concat(t.type,"); Run enableUnsafeWorldLoading() to ignore this"));return[r,n]}function Nt(t,e,i){return new Promise((function(r,n){i(t,(function(t){xt[e]=t,r(t)}),n)}))}function Ut(t){return Pt++,new Promise((function(e,i){t.resolve=e,t.reject=i,Dt(t)}))}function Vt(t,e){var i=l(e,2),r=i[0],n=i[1];if(void 0===r)throw Error("Can't load asset without an path");void 0===n&&(n=r);var o=r.split("."),a=o.shift(),s="";o.length>0&&(s="."+o.join("."));var h=bt[t];if(!h.has(s))throw Error("Can't load (".concat(s,") file as a ").concat(t," file, try ").concat(Array.from(h).join(" ")));return{name:n,basePath:a,fullPath:r,extension:s}}var Xt,Yt=0,Gt=0;function qt(){Yt=Math.round(Kt())}function Ht(){return Yt}function Kt(){return window.performance.now()}qt();var Qt=[];function Jt(t){Xt=t}function Zt(){if(void 0===Xt)throw Error("Could not find default viewpoint; maybe run Brass.init() first");return Xt}var $t,te,ee,ie,re=function(){function t(t,e,i){var r,n,o;void 0===i&&(i={}),this.shakeStrength=0,this.shakeDecay=0,this.scale=t,this.translation=e,this.integerTranslation=null===(r=i.integerTranslation)||void 0===r||r,this.integerScaling=null!==(n=i.integerScaling)&&void 0!==n&&n,this.shakeSpeed=null!==(o=i.shakeSpeed)&&void 0!==o?o:.015,this.shakePosition=new E,Qt.push(this)}return t.prototype.view=function(t){void 0===t&&(t=it("defaultP5"));var e=t.getMaps().canvas,i=this.getViewOrigin(t);e.translate(i.x,i.y),e.scale(this.effectiveScale);var r=this.effectiveTranslation;e.translate(-r.x,-r.y),e.translate(-this.shakePosition.x,-this.shakePosition.y)},t.prototype.getViewArea=function(t){void 0===t&&(t=it("defaultP5"));var e=t.getMaps().canvas,i=this.effectiveTranslation;return i.sub(this.getViewOrigin(t)),{minX:i.x,maxX:i.x+e.width,minY:i.y,maxY:i.y+e.height}},t.prototype.traslateScreen=function(t){var e=t.copy().divScalar(this.effectiveScale);this.translation.add(e)},t.prototype.screenToWorld=function(t,e){void 0===e&&(e=it("defaultP5")),e.getMaps().canvas;var i=t.copy(),r=this.getViewOrigin(e);i.sub(r),i.divScalar(this.effectiveScale);var n=this.effectiveTranslation;return i.add(n),i.add(this.shakePosition),i},t.prototype.worldToScreen=function(t,e){void 0===e&&(e=it("defaultP5")),e.getMaps().canvas;var i=t.copy();i.sub(this.shakePosition);var r=this.effectiveTranslation;i.sub(r),i.multScalar(this.effectiveScale);var n=this.getViewOrigin(e);return i.add(n),i},Object.defineProperty(t.prototype,"effectiveTranslation",{get:function(){return this.integerTranslation?this.translation.copy().multScalar(this.effectiveScale).round().divScalar(this.effectiveScale):this.translation.copy()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"effectiveScale",{get:function(){return this.integerScaling?this.scale>1?Math.round(this.scale):1/Math.round(1/this.scale):this.scale},enumerable:!1,configurable:!0}),t.prototype.shake=function(t,e){void 0===e&&(e=1e3),this.shakeStrength+=t,this.shakeDecay+=t/e},t.prototype.updateShake=function(t){this.shakeStrength-=this.shakeDecay*t,this.shakeStrength<=0&&(this.shakeStrength=0,this.shakeDecay=0),this.shakePosition.x=.3*noise(8104,Ht()*this.shakeSpeed*2)+.7*noise(9274,Ht()*this.shakeSpeed/2),this.shakePosition.y=.3*noise(5928,Ht()*this.shakeSpeed*2)+.7*noise(2395,Ht()*this.shakeSpeed/2),this.shakePosition.subScalar(.5).multScalar(this.shakeStrength)},t}(),ne=function(t){function e(e,i,r){return void 0===e&&(e=100),void 0===i&&(i=new E),void 0===r&&(r={}),t.call(this,e,i,r)||this}return o(e,t),e.prototype.update=function(t){},e.prototype.getViewOrigin=function(){return new E(0,0)},e}(re),oe=function(t){function e(e,i,r){void 0===e&&(e=100),void 0===i&&(i=new E),void 0===r&&(r={});var n,o,a,s,h,l=this;return(l=t.call(this,e,i,r)||this).velocity=new E,l._target=l.translation.copy(),l.previousTarget=l._target.copy(),"follow"in r||"drag"in r||"outrun"in r?(l.jump=null!==(n=r.jump)&&void 0!==n?n:0,l.follow=null!==(o=r.follow)&&void 0!==o?o:.001,l.drag=null!==(a=r.drag)&&void 0!==a?a:.1,l.outrun=null!==(s=r.outrun)&&void 0!==s?s:0):(l.jump=null!==(h=r.jump)&&void 0!==h?h:.1,l.follow=0,l.drag=0,l.outrun=0),l}return o(e,t),e.prototype.update=function(t){var e=this.target.copy().sub(this.previousTarget);this.velocity.multScalar(Math.pow(1-this.drag,t));var i=this.target.copy().sub(this.translation);this.velocity.add(i.copy().multScalar(this.follow*t)),this.velocity.add(e.copy().multScalar(this.outrun*t));var r=Math.pow(this.jump+1,Math.pow(t,this.jump));this.translation.add(this.target.copy().multScalar(r-1)),this.translation.divScalar(r),this.translation.add(this.velocity),this.previousTarget=this.target.copy(),this.updateShake(t)},e.prototype.getViewOrigin=function(t){var e=t.getMaps().canvas;return this.integerTranslation?new E(Math.round(e.width/2),Math.round(e.height/2)):new E(e.width/2,e.height/2)},Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!1,configurable:!0}),e}(re),ae=[];function se(t){te=0===t.length?[""]:t,he()}function he(){var t=Math.floor(Math.random()*te.length);if(te.length>1)for(;ee===t;)t=Math.floor(Math.random()*te.length);ee=t,ie=Ht()+50*te[ee].length+1500}function le(t){void 0===t&&(t=it("defaultP5"));var e=t.getMaps().canvas;e.push(),e.resetMatrix(),e.colorMode(HSL),e.background($t,60,20);var i="".concat("".concat(Et," / ").concat(Pt)," (").concat(Math.floor(100*Ot()),"%)"),r=.1*Math.min(e.width,e.height);e.textSize(r),e.textAlign(CENTER,CENTER),e.textStyle(BOLD),e.noStroke();var n=($t+180)%360;e.fill(n,100,10),e.text(i,.5*e.width+.05*r,.3*e.height+.05*r),e.fill(n,70,60),e.text(i,.5*e.width-.05*r,.3*e.height-.05*r),e.textAlign(CENTER,TOP),e.textStyle(NORMAL),e.textSize(.6*r),ie<Ht()&&he();var o=te[ee];e.fill(n,100,10),e.text(o,.05*e.width+.03*r,.65*e.height+.03*r,.9*width,1/0),e.fill(n,70,60),e.text(o,.05*e.width-.03*r,.65*e.height-.03*r,.9*width,1/0),e.strokeWeight(.1*Math.min(e.width,e.height)),e.stroke(n,100,10),e.line(.1*e.width,.5*e.height,.9*e.width,.5*e.height),e.strokeWeight(.08*Math.min(e.width,e.height)),e.stroke(n,70,60),e.line(.1*e.width,.5*e.height,.1*e.width+.8*e.width*Ot(),.5*e.height),e.pop()}$t=360*Math.random(),se(["...loading"]);var ue=new Map,ce=300;function de(t){var e,i;try{for(var r=h(ue),n=r.next();!n.done;n=r.next()){var o=l(n.value,2),a=o[0],s=o[1];s.update(t),s.alive()||(s.kill(),ue.delete(a))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}ue.size>ce&&function(t){var e=u([],l(ue.entries()),!1).sort((function(t,e){return t[1].radius-e[1].radius}));t=Math.min(t,Math.floor(e.length/5));for(var i=0;i<5*t;i+=5)e[i][1].kill(),ue.delete(e[i][0])}(ue.size-ce)}function fe(t,e,i){var r=new(t.bind.apply(t,u([void 0,E.fromObjFast(e)],l(i),!1)));ue.set(Symbol(),r)}var pe,ye=function(){function t(t){this.radius=1,this.lifetime=5e3,this.position=E.fromObj(t),this.spawnTime=Ht()}return t.prototype.update=function(t){},t.prototype.draw=function(t){t.noStroke(),t.fill(255,0,255),t.circle(0,0,2)},t.prototype.alive=function(){return this.age<1},t.prototype.kill=function(){},Object.defineProperty(t.prototype,"age",{get:function(){return(Ht()-this.spawnTime)/this.lifetime},enumerable:!1,configurable:!0}),t}(),ve=function(t){function e(e,i){void 0===i&&(i=new E);var r=t.call(this,e)||this;return r.velocity=i,r}return o(e,t),e.prototype.updateKinomatics=function(t){this.position.add(this.velocity.copy().multScalar(t))},e.prototype.collide=function(t){var e=this.position.copy().divScalar(t.tileSize),i=e.x,r=e.y,n=this.radius/t.tileSize,o=0,a=0;if(t.getSolid(Math.floor(i-n),Math.floor(r))&&!t.getSolid(Math.floor(i-n)+1,Math.floor(r))&&(o=Math.ceil(i-n)+n-i),t.getSolid(Math.floor(i+n),Math.floor(r))&&!t.getSolid(Math.floor(i+n)-1,Math.floor(r))){var s=Math.floor(i+n)-n-i;(0===o||Math.abs(s)<Math.abs(o))&&(o=s)}if(t.getSolid(Math.floor(i),Math.floor(r-n))&&!t.getSolid(Math.floor(i),Math.floor(r-n)+1)&&(a=Math.ceil(r-n)+n-r),t.getSolid(Math.floor(i),Math.floor(r+n))&&!t.getSolid(Math.floor(i),Math.floor(r+n)-1)){var h=Math.floor(r+n)-n-r;(0===a||Math.abs(h)<Math.abs(a))&&(a=h)}0!==o&&0!==a?Math.abs(o)<Math.abs(a)?(this.position.x+=o*t.tileSize,this.velocity.x=0):(this.position.y+=a*t.tileSize,this.velocity.y=0):0!==o?(this.position.x+=o*t.tileSize,this.velocity.x=0):0!==a&&(this.position.y+=a*t.tileSize,this.velocity.y=0)},e}(ye);!function(t){t[t.Inital=0]="Inital",t[t.Processing=1]="Processing",t[t.Failed=2]="Failed",t[t.Succeed=3]="Succeed"}(pe||(pe={}));var ge=[],me=0,we=.1;var be,xe,Se,Ce=function(){function t(t){var e,i,r,n,o,a,s,h,l,u;if(this.confidence=.5,this.width=t.width,this.height=t.height,this.scale=null!==(e=t.scale)&&void 0!==e?e:1,this.faliureDelay=null!==(i=t.faliureDelay)&&void 0!==i?i:300,this.pathingRuntimeLimit=null!==(r=t.pathingRuntimeLimit)&&void 0!==r?r:2e4,this.pathingContinuousRuntimeLimit=null!==(n=t.pathingContinuousRuntimeLimit)&&void 0!==n?n:2e3,this.pathGarbageLimit=null!==(o=t.pathGarbageLimit)&&void 0!==o?o:.15,this.targetDriftLimit=null!==(a=t.targetDriftLimit)&&void 0!==a?a:2,this.targetDriftInfluence=null!==(s=t.targetDriftInfluence)&&void 0!==s?s:.12,this.nodeComfirmationRate=null!==(h=t.nodeComfirmationRate)&&void 0!==h?h:10,this.pheromoneDecayTime=null!==(l=t.pheromoneDecayTime)&&void 0!==l?l:15e4,this.pheromoneStrength=null!==(u=t.pheromoneStrength)&&void 0!==u?u:.5,this.pheromoneTime=Ht(),!1!==t.pheromones){var c=this.pheromoneTime-this.pheromoneDecayTime;this.pheromones=new Int32Array(this.width*this.height).fill(c)}else this.pheromones=null;this.goal=null,this.agents=[],this.waitingAgent=0,ge.push(this)}return t.prototype.createAgent=function(t,e){t/=this.scale;var i=new ke(this,t,e);return this.agents.push(i),i},t.prototype.removeAgent=function(t){var e=this.agents.findIndex((function(e){return e.id===t.id}));this.waitingAgent>e&&this.waitingAgent--,this.agents.splice(e,1)},t.prototype.setGoal=function(t){var e,i;if(null===t)return this.goal=null,!1;var r=t.copy().divScalar(this.scale);if(!this.validatePosition(r))return this.goal=null,!1;this.goal=r;try{for(var n=h(this.agents),o=n.next();!o.done;o=n.next()){var a=o.value;if(!(a.path.length<=0))a.path[a.path.length-1].dist(this.goal)<we||(a.newGoal=!0)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return!0},t.prototype.confidenceDelta=function(t){this.confidence=Math.min(Math.max(this.confidence+t,0),1)},t.prototype.update=function(t){if(null!==this.goal){this.confidence<.2&&this.confidenceDelta(.01),this.pheromoneTime=Ht();for(var e=Ht()-this.faliureDelay,i=Math.max.apply(Math,u([],l(this.agents.map((function(t){return t.leadership}))),!1)),r=Math.max(this.confidence,1.01-i),n=this.waitingAgent+this.agents.length,o=this.waitingAgent;o<n;o++){var a=o%this.agents.length;this.waitingAgent=(o+1)%this.agents.length;var s=this.agents[a];if(!(s.pathFailTime>e))if(s.path.length>0&&this.confirmAgentNodes(s),s.computeStart||s.computeEnd){if(null!==s.position)if(s.leadership<1-r)s.reset();else{t:if(null!==s.processingSituation){var h=s.processingSituation.start.dist(s.position)+s.processingSituation.end.dist(this.goal);if(s.processingSituation.maxRuntime=Math.ceil(s.processingSituation.maxRuntime/(1+h*this.targetDriftInfluence)),(d=this.computePath(s.processingSituation)).type===pe.Processing)break t;if(d.type===pe.Failed){h>this.targetDriftLimit?(s.processingSituation=null,s.tryedPartCompute=!1):s.tryedPartCompute?s.reset():(s.processingSituation=null,s.tryedPartCompute=!0);break t}s.tryedPartCompute?this.afterAgentComputeWhole(s,d):this.afterAgentComputePart(s,d),s.tryedPartCompute=!1}else{if(s.path.length>0&&!s.tryedPartCompute){var c=this.attemptAgentPartCompute(s);if(void 0!==c){this.afterAgentComputePart(s,c);break t}if(null!==s.processingSituation)break t}var d;void 0!==(d=this.attemptAgentWholeCompute(s))&&this.afterAgentComputeWhole(s,d)}if(Kt()>t)return}}else this.confidenceDelta(.001)}}},t.prototype.confirmAgentNodes=function(t){for(var e=Math.min(t.path.length,this.nodeComfirmationRate),i=0;i<e;i++){t.waitingNodeComfirmation>=t.path.length&&(t.waitingNodeComfirmation=0);var r=t.path[t.waitingNodeComfirmation],n=t.radius;if(t.waitingNodeComfirmation===t.path.length-1&&(n=0),!this.confirmNode(r,n)){t.reset();break}t.waitingNodeComfirmation++}},t.prototype.attemptAgentPartCompute=function(t){f(null!==this.goal),f(null!==t.position);var e=0,i=t.pathCost*this.pathGarbageLimit;if(t.computeStart&&(e+=100*t.position.dist(t.path[0])),t.computeEnd&&(e+=100*t.path[t.path.length-1].dist(this.goal)),!(t.pathGarbage+e>i)){var r,n=Math.ceil(this.pathingRuntimeLimit*this.pathGarbageLimit);if((r=t.computeStart?this.computePath(t.position,t.path[0],n):this.computePath(t.path[t.path.length-1],this.goal,n)).type!==pe.Processing){if(r.type!==pe.Failed)return r}else t.processingSituation=r}},t.prototype.afterAgentComputePart=function(t,e){var i=t.pathCost*this.pathGarbageLimit,r=e.cost;if(!(t.pathGarbage+r>i)){var n=this.spaceOutPath(e.path);t.computeStart?(t.path=n.concat(t.path),t.computeStart=!1):(t.path=t.path.concat(n),t.computeEnd=!1),t.pathGarbage+=r}},t.prototype.attemptAgentWholeCompute=function(t){f(null!==this.goal),f(null!==t.position);var e=this.computePath(t.position,this.goal,this.pathingRuntimeLimit);if(e.type!==pe.Processing){if(e.type!==pe.Failed)return e}else t.processingSituation=e},t.prototype.afterAgentComputeWhole=function(t,e){var i=this.spaceOutPath(e.path);t.setPath(i,e.cost),t.computeWhole=!1},t.prototype.spaceOutPath=function(t){for(var e=t.map(E.fromObjFast),i=[],r=0;r<e.length-1;r++){var n=e[r].dist(e[r+1]);if(i.push(e[r]),n>1.01)for(var o=1/n,a=(n-Math.floor(n/1))/n/2;a<1;a+=o){var s=e[r].copy().mix(e[r+1],a);i.push(s)}}return i.push(e[e.length-1]),i},t.prototype.parseComputePathArgs=function(t){return 1===t.length?t[0]:{start:t[0],end:t[1],maxRuntime:t[2],runtime:0,type:pe.Inital}},t.prototype.getPheromones=function(t){var e=t.x,i=t.y;if(null===this.pheromones)return 1;var r=this.pheromones[e+i*this.width],n=this.pheromoneTime-r,o=(this.pheromoneDecayTime-n)/this.pheromoneDecayTime;return Math.max(0,1-o*o*this.pheromoneStrength)},t.prototype.setPheromones=function(t){var e=t.x,i=t.y;null!==this.pheromones&&(this.pheromones[e+i*this.width]=this.pheromoneTime)},t.prototype.validatePosition=function(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height},t}(),Me=function(t){function e(e,i){void 0===i&&(i={});var r=this;return i.width=e.width,i.height=e.height,i.scale=e.tileSize,(r=t.call(this,i)||this).tilemap=e,r}return o(e,t),e.prototype.createAgent=function(e,i){if(e>.5*this.scale)throw Error("AStarPathfinder can't handle agents wider than one tilemap cell");return t.prototype.createAgent.call(this,e,i)},e.prototype.computePath=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.parseComputePathArgs(t);return(i=this.computeAStar(i)).type===pe.Succeed&&(i.path=i.path.map((function(t){return{x:t.x+.5,y:t.y+.5}})),i.path.unshift(i.start.copy()),i.path.push(i.end.copy())),i},e.prototype.computeAStar=function(t){var e,i;if(t.type===pe.Inital){if(this.tilemap.getSolid(t.start.x,t.start.y)||this.tilemap.getSolid(t.end.x,t.end.y))return t.type=pe.Failed,t;t.type=pe.Processing,t.state={gCosts:new Map,fCosts:new Map,sources:new Map,open:new b([],(function(e,i){return t.state.fCosts.get(e)<t.state.fCosts.get(i)}))}}var r=t.start.copy().floor(),n=t.end.copy().floor(),o=this.primitivizePosition(r),a=this.primitivizePosition(n),s=t.state,l=s.gCosts,u=s.fCosts,c=s.sources,d=s.open;l.set(o,0),u.set(o,this.heuristic(r,n)),c.set(o,null),d.insert(o);for(var f=t.runtime;d.size>0;){if(t.runtime>=t.maxRuntime)return t.type=pe.Failed,this.confidenceDelta(-.05),t;if(t.runtime-f>=this.pathingContinuousRuntimeLimit)return this.confidenceDelta(-.01),t;t.runtime++;var p=d.remove(),y=this.deprimitivizePosition(p);if(p===a)return this.reconstructPath(t,p,l,c);var v=l.get(p),g=this.computeNeighbors(y);try{for(var m=(e=void 0,h(g)),w=m.next();!w.done;w=m.next()){var x=w.value,S=x.position,C=x.dCost,M=this.primitivizePosition(S),k=v+Math.round(C*this.getPheromones(S)),z=l.get(M);(void 0===z||k<z)&&(c.set(M,p),l.set(M,k),u.set(M,k+this.heuristic(S,n)),d.insert(M))}}catch(t){e={error:t}}finally{try{w&&!w.done&&(i=m.return)&&i.call(m)}finally{if(e)throw e.error}}}return t.type=pe.Failed,t},e.prototype.computeNeighbors=function(t){var e=t.x,i=t.y,r=[],n=!1===this.tilemap.getSolid(e-1,i),o=!1===this.tilemap.getSolid(e+1,i),a=!1===this.tilemap.getSolid(e,i-1),s=!1===this.tilemap.getSolid(e,i+1);return n&&r.push({position:{x:e-1,y:i},dCost:100}),o&&r.push({position:{x:e+1,y:i},dCost:100}),a&&(r.push({position:{x:e,y:i-1},dCost:100}),n&&!1===this.tilemap.getSolid(e-1,i-1)&&r.push({position:{x:e-1,y:i-1},dCost:141}),o&&!1===this.tilemap.getSolid(e+1,i-1)&&r.push({position:{x:e+1,y:i-1},dCost:141})),s&&(r.push({position:{x:e,y:i+1},dCost:100}),n&&!1===this.tilemap.getSolid(e-1,i+1)&&r.push({position:{x:e-1,y:i+1},dCost:141}),o&&!1===this.tilemap.getSolid(e+1,i+1)&&r.push({position:{x:e+1,y:i+1},dCost:141})),r},e.prototype.reconstructPath=function(t,e,i,r){for(var n=[],o=i.get(e),a=e;null!==a;)n.push(this.deprimitivizePosition(a)),a=r.get(a);return n.reverse(),t.type=pe.Succeed,t.path=n,t.cost=o,t},e.prototype.primitivizePosition=function(t){var e=t.x,i=t.y;return e+this.tilemap.width*i},e.prototype.deprimitivizePosition=function(t){return{x:t%this.tilemap.width,y:Math.floor(t/this.tilemap.width)}},e.prototype.heuristic=function(t,e){return Math.round(100*Math.hypot(e.x-t.x,e.y-t.y))},e.prototype.confirmNode=function(t,e){for(var i=Math.floor(t.x-e),r=Math.ceil(t.x+e),n=Math.floor(t.y-e),o=Math.ceil(t.y+e),a=i;a<r;a++)for(var s=n;s<o;s++)if(this.tilemap.getSolid(Math.floor(a),Math.floor(s)))return!1;return!0},e}(Ce),ke=function(){function t(t,e,i){void 0===i&&(i=Math.random()),this.id=Symbol(),this.position=null,this.direction=!1,this.newGoal=!0,this.processingSituation=null,this.tryedPartCompute=!1,this.pathCost=0,this.pathGarbage=0,this.path=[],this.waitingNodeComfirmation=0,this.computeStart=!0,this.computeEnd=!0,this.pathFailTime=0,this.pathfinder=t,this.radius=e,this.leadership=i}return t.prototype.drawPath=function(t,e,i){void 0===t&&(t=.2),void 0===e&&(e="red"),void 0===i&&(i=it("defaultP5"));var r=i.getMaps().canvas;if(null!==this.position){r.push(),r.noStroke(),r.fill(e),this.path.unshift(this.position);for(var n=0;n<this.path.length;n++){var o=this.path[n].copy().multScalar(this.pathfinder.scale);if(r.circle(o.x,o.y,t),!(n>=this.path.length-1)){var a=this.path[n+1].copy().multScalar(this.pathfinder.scale),s=a.copy().sub(o).norm(t/2),h=s.copy().rotate(-HALF_PI),l=s.copy().rotate(HALF_PI);r.triangle(o.x+h.x,o.y+h.y,a.x,a.y,o.x+l.x,o.y+l.y)}}this.path.shift(),r.pop()}},t.prototype.getDirection=function(t){if(!t||null!==this.position&&this.position.equal(t)){if(this.direction)return this.direction}else{var e=t.copy().divScalar(this.pathfinder.scale);if(!this.pathfinder.validatePosition(e))return this.position=null,!1;this.position=e}if(null===this.position)return!1;for(;this.path.length>0;){if(!(this.position.dist(this.path[0])<we)){this.position.dist(this.path[0])>2&&(this.processingSituation&&(this.tryedPartCompute=!1,this.processingSituation=null),this.computeStart=!0);break}var i=this.path.shift().floor();this.pathfinder.setPheromones(i)}if(0===this.path.length||this.computeStart){if(null===this.pathfinder.goal)return!1;var r=this.position.dist(this.pathfinder.goal)<.2;return r?this.setPath([]):0===this.path.length&&(this.computeWhole=!0),r}return this.direction=this.path[0].copy().multScalar(this.pathfinder.scale).sub(this.position.copy().multScalar(this.pathfinder.scale)),this.newGoal&&this.direction.mag<.30000000000000004&&random()<.2&&(this.processingSituation&&(this.tryedPartCompute=!1,this.processingSituation=null),this.computeEnd=!0,this.newGoal=!1),this.direction},t.prototype.reset=function(){this.setPath([]),this.tryedPartCompute=!1,this.processingSituation=null,this.computeStart=!0,this.computeEnd=!0,this.pathFailTime=Ht()},t.prototype.setPath=function(t,e){void 0===e&&(e=0),this.pathCost=e,this.pathGarbage=0,this.path=t},Object.defineProperty(t.prototype,"computeWhole",{get:function(){return this.computeStart&&this.computeEnd},set:function(t){this.computeStart=t,this.computeEnd=t},enumerable:!1,configurable:!0}),t}(),ze=!1,Pe=null,Te=new Map,Ee=Array(32).fill(null).map((function(){return new Map}));function Ae(t){var e,i;if(void 0===t&&(t={}),"object"!=typeof Matter)throw Error("Matter was not found; Can't initialize Brass physics without Matter.js initialized first");null!==(e=t.gravity)&&void 0!==e||(t.gravity={scale:0}),Se=null!==(i=t.spaceScale)&&void 0!==i?i:1;var r=t;be=Matter.Engine.create(r),xe=be.world,Matter.Events.on(be,"collisionActive",De),ze=!0}function De(t){t.pairs.map((function(t){var e,i,r=t.bodyA.__brassBody__,n=t.bodyB.__brassBody__,o=[];try{for(var a=h(t.activeContacts),s=a.next();!s.done;s=a.next()){var l=s.value.vertex;o.push(new E(l.x/Se,l.y/Se))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}r.triggerSensors({self:r,body:n,points:o.map((function(t){return t.copy()}))}),n.triggerSensors({self:n,body:r,points:o})}))}function Le(t){if(!ze)throw Error("Matter must be enabled in Brass.init() before ".concat(t))}var Be=function(){function t(){this.sensors=[],this.alive=!0,this.data=null,Le("creating a body")}return t.prototype.addSensor=function(t){return this.sensors.push(t),this},t.prototype.removeSensor=function(t){var e=[].findIndex((function(e){return e===t}));return this.sensors.splice(e,1),this},t.prototype.triggerSensors=function(t){return this.sensors.forEach((function(e){return e(t)})),this},t.prototype.kill=function(){this.alive=!1},t.prototype.validateCollisionIndex=function(t){if("number"!=typeof t||t!==Math.floor(t))throw Error("Collision category must be an integer");if(t<0||t>31)throw Error("Collision category must be in 0 through 31 inclusive");return t},t.prototype.validateCollisionMask=function(t){if("number"!=typeof t||t!==Math.floor(t))throw Error("Collision mask must be an integer");if(t<0||t>4294967295)throw Error("Collision mask must be 32-bit");return t},t.prototype.collisionIndexToCategory=function(t){return this.validateCollisionIndex(t),1<<t},t.prototype.collisionCategoryToIndex=function(t){if(32768===t)return 31;var e=Math.log2(t);if(e!==Math.floor(e))throw Error("Internal Matter.js body could not be fit in one collision category");return e},t}(),Re=function(t){function e(e){var i=t.call(this)||this;return i.setBody(e),i}return o(e,t),e.prototype.setBody=function(t){void 0!==this.body&&this.destroy(),this.body=t,this.body.__brassBody__=this,this.body.collisionFilter.category=this.collisionIndexToCategory(0),Ee[0].set(this.body.id,this),Matter.World.add(xe,t)},e.prototype.removeBody=function(){},Object.defineProperty(e.prototype,"position",{get:function(){return B(E.fromObj(this.body.position).divScalar(Se),this.setPosition.bind(this))},set:function(t){t=Matter.Vector.create(t.x*Se,t.y*Se),Matter.Body.setPosition(this.body,t)},enumerable:!1,configurable:!0}),e.prototype.setPosition=function(t){this.position=t},Object.defineProperty(e.prototype,"velocity",{get:function(){return B(E.fromObj(this.body.velocity).divScalar(Se),this.setVelocity.bind(this))},set:function(t){t=Matter.Vector.create(t.x*Se,t.y*Se),Matter.Body.setVelocity(this.body,t)},enumerable:!1,configurable:!0}),e.prototype.setVelocity=function(t){this.velocity=t},Object.defineProperty(e.prototype,"angle",{get:function(){return this.body.angle},set:function(t){Matter.Body.setAngle(this.body,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angularVelocity",{get:function(){return this.body.angularVelocity},set:function(t){Matter.Body.setAngularVelocity(this.body,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return this.body.isStatic},set:function(t){Matter.Body.setStatic(this.body,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ghost",{get:function(){return this.body.isSensor},set:function(t){this.body.isSensor=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionCategory",{set:function(t){var e=this.collisionCategoryToIndex(this.body.collisionFilter.category);Ee[e].delete(this.body.id),this.body.collisionFilter.category=this.collisionIndexToCategory(t),Ee[t].set(this.body.id,this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collidesWith",{set:function(t){var e=this;this.body.collisionFilter.mask=0,Array.isArray(t)?t.map((function(t){return e.setCollidesWith(t)})):this.setCollidesWith(t)},enumerable:!1,configurable:!0}),e.prototype.setCollidesWith=function(t){return this.validateCollisionIndex(t),t>=0?this.body.collisionFilter.mask|=1<<t:this.body.collisionFilter.mask&=~(1<<-t),this},e.prototype.rotate=function(t){return Matter.Body.rotate(this.body,t),this},e.prototype.applyForce=function(t,e){void 0===e&&(e=this.position);var i=Se*Se*Se*1e-6,r=Matter.Vector.create(t.x*i,t.y*i),n=Matter.Vector.create(e.x*Se,e.y*Se);return queueMicrotask(Matter.Body.applyForce.bind(globalThis,this.body,n,r)),this},e.prototype.kill=function(){t.prototype.kill.call(this),this.destroy()},e.prototype.destroy=function(){var t=this.collisionCategoryToIndex(this.body.collisionFilter.category);Ee[t].delete(this.body.id),Matter.World.remove(xe,this.body)},e}(Be),je=function(t){function e(e,i,r,n,o){var a=Matter.Bodies.rectangle(e*Se,i*Se,r*Se,n*Se,o);return t.call(this,a)||this}return o(e,t),e}(Re),Oe=function(t){function e(e,i,r,n){var o=Matter.Bodies.circle(e*Se,i*Se,r*Se,n);return t.call(this,o)||this}return o(e,t),e}(Re),Fe=function(t){function e(e,i,r,n){var o=r.map((function(t){return t.map((function(t){return Matter.Vector.create(t.x*Se,t.y*Se)}))})),a=Matter.Bodies.fromVertices(e*Se,i*Se,o,n);return t.call(this,a)||this}return o(e,t),e}(Re),Ie=function(t){function e(e,i,r,n,o){void 0===n&&(n={}),void 0===o&&(o=1);var a,s=this;s=t.call(this,Matter.Body.create({}))||this,null!==(a=n.isStatic)&&void 0!==a||(n.isStatic=!0);var h={x:0,y:0};return n.position&&(h=n.position,n.position={x:0,y:0}),s.x=h.x,s.y=h.y,s.width=e,s.height=i,s.gridScale=o,s.options=n,s.buildBody(r),s}return o(e,t),e.prototype.buildBody=function(t,e,i,r,n){var o;if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1/0),void 0===n&&(n=1/0),this.static)this.buildParts(t,e,i,r,n),Matter.Body.translate(this.body,{x:this.body.bounds.min.x+(this.x-e*this.gridScale)*Se,y:this.body.bounds.min.y+(this.y-i*this.gridScale)*Se});else{var a=null!==(o=this.options.angle)&&void 0!==o?o:0;void 0!==this.body&&(a=this.body.angle,Matter.Body.setAngle(this.body,0)),this.buildParts(t,e,i,r,n),Matter.Body.setAngle(this.body,a),Matter.Body.setPosition(this.body,{x:this.x*Se,y:this.y*Se})}},Object.defineProperty(e.prototype,"static",{get:function(){return void 0===this.body?this.options.isStatic:this.body.isStatic},enumerable:!1,configurable:!0}),e.prototype.buildParts=function(t,e,i,r,n){for(var o,a,s,u,c=Math.max(0,e),d=Math.max(0,i),f=Math.min(this.width,r),p=Math.min(this.height,n),y=new Map,v=d;v<p;v++){for(var g=void 0,m=c;m<f;m++)t[m+v*this.width]?void 0===g&&(g=m):void 0!==g&&(y.set(g+v*this.width,{width:m-g,height:1}),g=void 0);void 0!==g&&y.set(g+v*this.width,{width:f-g,height:1})}try{for(var w=h(y.entries()),b=w.next();!b.done;b=w.next())for(var x=l(b.value,2),S=x[0],C=x[1],M=S;;){M+=this.width;var k=y.get(M);if(void 0===k||k.width!==C.width)break;C.height+=k.height,y.delete(M)}}catch(t){o={error:t}}finally{try{b&&!b.done&&(a=w.return)&&a.call(w)}finally{if(o)throw o.error}}var z=[],P=this.gridScale*Se;try{for(var T=h(y.entries()),E=T.next();!E.done;E=T.next()){var A=l(E.value,2),D=A[0],L=(C=A[1],_e((m=D%this.width)*P,(v=Math.floor(D/this.width))*P,C.width*P,C.height*P));L.__brassBody__=this,z.push(L)}}catch(t){s={error:t}}finally{try{E&&!E.done&&(u=T.return)&&u.call(T)}finally{if(s)throw s.error}}var B=_e(e*P,i*P,.01,.01);B.__brassBody__=this,z.push(B),this.options.parts=z;var R=Matter.Body.create(this.options);this.setBody(R)},e}(Re);function _e(t,e,i,r){var n={id:Matter.Common.nextId(),type:"body",label:"rectBody",plugin:{},parts:[],angle:0,vertices:[{x:.5*-i,y:.5*-r,index:0,isInternal:!1},{x:.5*i,y:.5*-r,index:1,isInternal:!1},{x:.5*i,y:.5*r,index:2,isInternal:!1},{x:.5*-i,y:.5*r,index:3,isInternal:!1}],position:{x:t+.5*i,y:e+.5*r},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,circleRadius:0,positionPrev:{x:t+.5*i,y:e+.5*r},anglePrev:0,area:0,mass:0,inertia:0,_original:null};return n.parts=[n],n.parent=n,Matter.Body.set(n,{bounds:Matter.Bounds.create(n.vertices),vertices:n.vertices}),Matter.Bounds.update(n.bounds,n.vertices,n.velocity),n}var We=function(t){function e(e,i,r,n){void 0===r&&(r=.1),void 0===n&&(n={});var o,a,s=this;return(s=t.call(this)||this).id=Symbol(),s.position=new E(e,i),s.velocity=E.fromObj(null!==(o=n.velocity)&&void 0!==o?o:{x:0,y:0}),s.width=r,s.mask=s.validateCollisionMask(null!==(a=n.mask)&&void 0!==a?a:4294967295),Te.set(s.id,s),s}return o(e,t),Object.defineProperty(e.prototype,"angle",{get:function(){throw Error("RayBody can't have rotation")},set:function(t){throw Error("RayBody can't have rotation")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angularVelocity",{get:function(){throw Error("RayBody can't have rotation")},set:function(t){throw Error("RayBody can't have rotation")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!1},set:function(t){if(!0===t)throw Error("RayBody can't have static behaviour enabled")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ghost",{get:function(){return!0},set:function(t){if(!1===t)throw Error("RayBody can't have ghost behaviour disabled")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionCategory",{set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collidesWith",{set:function(t){var e=this;this.mask=0,Array.isArray(t)?t.map((function(t){return e.setCollidesWith(t)})):this.setCollidesWith(t)},enumerable:!1,configurable:!0}),e.prototype.setCollidesWith=function(t){return this.validateCollisionIndex(t),t>=0?this.mask|=1<<t:this.mask&=~(1<<-t),this},e.prototype.rotate=function(t){throw Error("RayBody can't have rotation")},e.prototype.applyForce=function(){throw Error("RayBody can't have forces applied")},e.prototype.kill=function(){t.prototype.kill.call(this),this.destroy()},e.prototype.destroy=function(){Te.delete(this.id)},e.prototype.cast=function(t,e){void 0===e&&(e=20);for(var i=[],r=0;r<32;r++)this.mask&1<<r&&i.push.apply(i,u([],l(Array.from(Ee[r].values())),!1));var n,o=i.map((function(t){return t.body})),a=t/1e3*60,s=this.velocity.copy().multScalar(Se*a),h=this.position.copy().multScalar(Se),c=1,d=.5,f=[],p=s.copy().multScalar(c).add(h),y=1;for(r=0;r<e;r++){var v=s.copy().multScalar(c).add(h),g=Matter.Query.ray(o,h,v,this.width*Se);if(g.length<1){if(0===r)break;c+=d,d/=2}else 1===g.length?(f=g,y=c,p=v,c-=d,d/=2):(1!==g.length&&(f=g,y=c,p=v),c-=d,d/=2)}return f.length>1&&(f=f.sort((function(t,e){return h.distSq(t.bodyA.position)-h.distSq(e.bodyA.position)}))),n=0===f.length?null:f[0].parentA.__brassBody__,{point:p.divScalar(Se),dist:this.velocity.mag*a*y,body:n}},e}(Be),Ne=[];var Ue,Ve,Xe,Ye,Ge=function(){function t(t,e,i){var r,n,o,a,s,h;void 0===i&&(i={}),this.width=t,this.height=e,this.tileSize=null!==(r=i.tileSize)&&void 0!==r?r:1,this.fields=[],this.fieldTypes=null!==(n=i.fields)&&void 0!==n?n:{_DEFAULTFIELD:"uint8"};var l=null!==(o=i.solidField)&&void 0!==o?o:"";if(void 0===this.fieldTypes[l])this.fieldTypes[l]="uint8";else if("uint8"!==this.fieldTypes[l])throw Error("Solid field must be of type uint8");for(var u in this.fields=[],this.fieldIds={},this.fieldTypes){var c=this.fieldTypes[u],d=u.toUpperCase();if(void 0!==this[d])throw Error("field name (".concat(d,") collided in tilemap namespace"));this[d]=this.fields.length,this.fieldIds[u]=this.fields.length,this.fields.push(this.createField(c))}this.solidFieldId=this.fieldIds[l],this.hasBody=!!i.body,this.autoMaintainBody=null===(a=i.autoMaintainBody)||void 0===a||a,this.getTileData=null!==(s=this.bindOptionsFunction(i.getTileData))&&void 0!==s?s:this.get,this.isTileSolid=null!==(h=this.bindOptionsFunction(i.isTileSolid))&&void 0!==h?h:null;var f=this.fields[this.solidFieldId];if(null!==this.isTileSolid){var p=this.isTileSolid(this.getTileData(0,0))?1:0;f.data.fill(p)}if(this.body=null,this.hasBody){var y={};"object"==typeof i.body&&(y=i.body),this.body=new Ie(this.width,this.height,f.data,y,this.tileSize)}this.bodyValid=this.hasBody,Ne.push(this)}return t.prototype.bindOptionsFunction=function(t){return t?function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return d(t.hasOwnProperty("prototype"),"Can't bind context to function (".concat(t.name,"); Use the Function keyword and do not bind before-hand")),t.bind.apply(t,u([e],l(i),!1))}(t,this):t},t.prototype.maintain=function(){this.autoMaintainBody&&this.maintainBody()},t.prototype.maintainBody=function(t,e,i,r){if(null!==this.body&&!this.bodyValid){var n=this.fields[this.solidFieldId];this.body.buildBody(n.data,t,e,i,r),this.bodyValid=!0}},t.prototype.get=function(t,e,i){if(void 0===i&&(i=0),this.validateCoord(t,e)){var r=this.fields[i];if(r.sparse){var n=r.data["".concat(t,",").concat(e)];return void 0===n?null:n}return r.data[t+e*this.width]}},t.prototype.set=function(t,e,i,r){if(void 0===r&&(r=0),!this.validateCoord(e,i))return!1;var n=this.fields[r];return n.sparse?n.data["".concat(e,",").concat(i)]=t:n.data[e+i*this.width]=t,this.clearCacheAtTile(e,i),this.updateSolidAtTile(e,i),!0},t.prototype.getSolid=function(t,e){var i=this.get(t,e,this.solidFieldId);if(void 0!==i)return Boolean(i)},t.prototype.export=function(){var t={};for(var e in this.fieldIds){var i=this.fieldIds[e],r=this.fieldTypes[e],n=this.fields[i].data;t[e]="sparse"===r?{type:"sparse",data:n}:"any"===r?{type:"any",data:n}:{type:r,data:z(n),encoding:r}}return{width:this.width,height:this.height,objects:[],tilesets:{},fields:t}},t.prototype.import=function(t){if(null===t)throw Error("Tried to import (null) as world; Did you pass Brass.getWorld() before the world loaded?");if(t.width>this.width||t.height>this.height)throw Error("Can't import world larger than tilemap");for(var e in this.clearCaches(),this.clearFields(),t.fields){var i=this.fieldIds[e];if(void 0===i)throw Error("Can't import field (".concat(e,"); field was not declared for the tilemap"));var r=this.fieldTypes[e],n=t.fields[e];if(void 0===r||r!==n.type)throw Error("Can't import field (".concat(e,"); field type did not match with any fields declared for the tilemap"));if("sparse"===n.type)this.fields[i]={sparse:!0,data:n.data};else{var o=void 0;if("encoding"in n){var a=P(n.encoding,n.data);o=n.encoding!==n.type?k(n.type,a):a}else o=n.data;if(this.width===t.width&&this.height===t.height)this.fields[i].data=o;else for(var s=0;s<t.width;s++)for(var h=0;h<t.height;h++)this.fields[i].data[s+h*this.width]=o[s+h*t.width]}}for(s=0;s<t.width;s++)for(h=0;h<t.height;h++)this.updateSolidAtTile(s,h)},t.prototype.updateSolidAtTile=function(t,e){if(null!==this.isTileSolid){var i=this.fields[this.solidFieldId],r=this.isTileSolid(this.getTileData(t,e)),n=t+e*this.width;null!==this.body&&!!i.data[n]!==r&&(this.bodyValid=!1),i.data[n]=r?1:0}},t.prototype.clearFields=function(){for(var t in this.fieldIds){var e=this.fieldIds[t];if(e!==this.solidFieldId){var i=this.fieldTypes[t];this.fields[e]=this.createField(i)}}for(var r=0;r<this.width;r++)for(var n=0;n<this.height;n++)this.updateSolidAtTile(r,n)},t.prototype.createField=function(t){if("sparse"===t)return{sparse:!0,data:{}};var e=function(t,e){return new(T(t))(e)}(t,this.area);return{sparse:!1,data:e}},t.prototype.validateCoord=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height},Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),t}(),qe=function(t){function e(e,i,r){void 0===r&&(r={});var n,o,a,s,h,l,u,c,d,f,p,v=this;if((v=t.call(this,e,i,r)||this).drawCacheMode=null!==(n=r.drawCacheMode)&&void 0!==n?n:"never",v.drawCacheChunkSize=null!==(o=r.drawCacheChunkSize)&&void 0!==o?o:"never"===v.drawCacheMode?1:4,v.drawCacheTileResolution=null!==(a=r.drawCacheTileResolution)&&void 0!==a?a:64,v.drawCacheDecayTime=null!==(s=r.drawCacheDecayTime)&&void 0!==s?s:5e3,v.drawCachePadding=null!==(h=r.drawCachePadding)&&void 0!==h?h:0,v.drawCachePaddingTime=null!==(l=r.drawCachePaddingTime)&&void 0!==l?l:3,null!==(u=v.width/v.drawCacheChunkSize%1!=0)&&void 0!==u?u:v.height/v.drawCacheChunkSize%1!=0)throw Error("Tilemap width and height must be a multiple of drawCacheChunkSize");var m=v.width*v.height/v.drawCacheChunkSize/v.drawCacheChunkSize;if("never"===v.drawCacheMode)v.chunkPool=null,v.chunks=[],v.cacheableChunks=[];else{var w=v.drawCacheTileResolution*v.drawCacheChunkSize,b=null!==(c=r.drawCachePoolInitalSize)&&void 0!==c?c:Math.ceil(window.innerWidth*window.innerHeight/w/w);v.chunkPool=new g(b,!1,(function(){return{g:y(w,w),lastUsed:Ht()}}),(function(t){return{g:t.g,lastUsed:Ht()}})),v.chunks=Array(m).fill(null),v.cacheableChunks=Array(m).fill(null)}if(v.drawTile=null!==(d=v.bindOptionsFunction(r.drawTile))&&void 0!==d?d:v.defaultDrawTile,v.drawOrder=null!==(f=v.bindOptionsFunction(r.drawOrder))&&void 0!==f?f:null,v.canCacheTile=null!==(p=v.bindOptionsFunction(r.canCacheTile))&&void 0!==p?p:null,null===v.canCacheTile&&"check"===v.drawCacheMode)throw Error('drawCacheMode of "check" requires canCacheTile function in options');return v}return o(e,t),e.prototype.draw=function(t,e){void 0===t&&(t=Zt()),void 0===e&&(e=it("defaultP5"));var i=e.getMaps().canvas,r=t.getViewArea(e);r.minX=Math.max(0,r.minX/this.tileSize),r.minY=Math.max(0,r.minY/this.tileSize),r.maxX=Math.min(this.width,r.maxX/this.tileSize),r.maxY=Math.min(this.height,r.maxY/this.tileSize),r.minX=Math.floor(r.minX/this.drawCacheChunkSize),r.minY=Math.floor(r.minY/this.drawCacheChunkSize),r.maxX=Math.ceil(r.maxX/this.drawCacheChunkSize),r.maxY=Math.ceil(r.maxY/this.drawCacheChunkSize),push(),scale(this.tileSize);var n=!1;switch(this.drawCacheMode){default:throw Error('drawCacheMode should be "never", "check" or "always" not ('.concat(this.drawCacheMode,")"));case"never":this.drawTiles(r.minX,r.minY,r.maxX,r.maxY,i);break;case"always":n=!0;case"check":d(null!==this.chunkPool),this.padChunks(n,t,e);for(var o=r.minX;o<r.maxX;o++)for(var a=r.minY;a<r.maxY;a++)if(n||this.canCacheChunk(o,a))this.drawChunk(o,a,i);else{var s=o+a*(this.width/this.drawCacheChunkSize);null!==(l=this.chunks[s])&&(this.chunkPool.release(l),this.chunks[s]=null),this.drawTiles(Math.max(r.minX*this.drawCacheChunkSize,o*this.drawCacheChunkSize),Math.max(r.minY*this.drawCacheChunkSize,a*this.drawCacheChunkSize),Math.min(r.maxX*this.drawCacheChunkSize,(o+1)*this.drawCacheChunkSize),Math.min(r.maxY*this.drawCacheChunkSize,(a+1)*this.drawCacheChunkSize),i)}this.cacheableChunks.fill(null);for(var h=0;h<this.chunks.length;h++){var l;null!==(l=this.chunks[h])&&Ht()-l.lastUsed>this.drawCacheDecayTime&&(this.chunkPool.release(l),this.chunks[h]=null)}}pop()},e.prototype.padChunks=function(t,e,i){void 0===e&&(e=Zt()),i.getMaps().canvas,d(null!==this.chunkPool);var r=e.getViewArea(i);r.minX=Math.max(0,r.minX/this.tileSize-this.drawCachePadding),r.minY=Math.max(0,r.minY/this.tileSize-this.drawCachePadding),r.maxX=Math.min(this.width,r.maxX/this.tileSize+this.drawCachePadding),r.maxY=Math.min(this.height,r.maxY/this.tileSize+this.drawCachePadding),r.minX=Math.floor(r.minX/this.drawCacheChunkSize),r.minY=Math.floor(r.minY/this.drawCacheChunkSize),r.maxX=Math.ceil(r.maxX/this.drawCacheChunkSize),r.maxY=Math.ceil(r.maxY/this.drawCacheChunkSize);for(var n=Kt()+this.drawCachePaddingTime,o=!1,a=r.minX;a<r.maxX;a++)for(var s=r.minY;s<r.maxY;s++){var h=a+s*(this.width/this.drawCacheChunkSize),l=this.chunks[h];null===l?o||!t&&!this.canCacheChunk(a,s)||(l=this.chunkPool.get(),this.chunks[h]=l,this.renderChunk(a,s,l),Kt()>n&&(o=!0)):l.lastUsed=Ht()}},e.prototype.canCacheChunk=function(t,e){d(null!==this.canCacheTile);var i=t+e*(this.height/this.drawCacheChunkSize),r=this.cacheableChunks[i];if(null!==r)return r;for(var n=0;n<this.drawCacheChunkSize;n++)for(var o=0;o<this.drawCacheChunkSize;o++){var a=n+t*this.drawCacheChunkSize,s=o+e*this.drawCacheChunkSize,h=this.getTileData(a,s);if(!this.canCacheTile(h))return this.cacheableChunks[i]=!1,!1}return this.cacheableChunks[i]=!0,!0},e.prototype.renderChunk=function(t,e,i){var r,n,o=i.g;o.push(),o.clear(0,0,0,0),o.scale(this.drawCacheTileResolution);for(var a=[],s=0;s<this.drawCacheChunkSize;s++)for(var l=0;l<this.drawCacheChunkSize;l++){var u=s+t*this.drawCacheChunkSize,c=l+e*this.drawCacheChunkSize,d=this.getTileData(u,c);this.drawOrder?a.push({data:d,x:s,y:l,order:this.drawOrder(d)}):this.drawTile(d,s,l,o)}if(this.drawOrder){a.sort((function(t,e){return t.order-e.order}));try{for(var f=h(a),p=f.next();!p.done;p=f.next()){var y=p.value;this.drawTile(y.data,y.x,y.y,o)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}}o.pop()},e.prototype.drawChunk=function(t,e,i){var r=this.maintainChunk(t,e);i.image(r,t*this.drawCacheChunkSize,e*this.drawCacheChunkSize,this.drawCacheChunkSize,this.drawCacheChunkSize)},e.prototype.maintainChunk=function(t,e){d(null!==this.chunkPool);var i=t+e*(this.width/this.drawCacheChunkSize),r=this.chunks[i];return(null===r||Ht()-r.lastUsed>this.drawCacheDecayTime)&&(null===r&&(r=this.chunkPool.get(),this.chunks[i]=r),this.renderChunk(t,e,r)),r.g},e.prototype.drawTiles=function(t,e,i,r,n){var o,a;n.push();for(var s=[],l=t;l<i;l++)for(var u=e;u<r;u++){var c=this.getTileData(l,u);this.drawOrder?s.push({data:c,x:l,y:u,order:this.drawOrder(c)}):this.drawTile(c,l,u,n)}if(this.drawOrder){s.sort((function(t,e){return t.order-e.order}));try{for(var d=h(s),f=d.next();!f.done;f=d.next()){var p=f.value;this.drawTile(p.data,p.x,p.y,n)}}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}}n.pop()},e.prototype.defaultDrawTile=function(t,e,i,r){r.noStroke();var n=(e+i)%2*255;r.fill(n),r.rect(e,i,1,1),r.fill(255-n),r.textAlign(CENTER,CENTER),r.textSize(.2),r.text(String(t),e+.5001,i+.5001)},e.prototype.clearCaches=function(){var t,e;if("never"!==this.drawCacheMode){d(null!==this.chunkPool);try{for(var i=h(this.chunks),r=i.next();!r.done;r=i.next()){var n=r.value;null!==n&&this.chunkPool.release(n)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}this.chunks.fill(null),this.cacheableChunks.fill(null)}},e.prototype.clearCacheAtTile=function(t,e){var i=Math.floor(t/this.drawCacheChunkSize)+Math.floor(e/this.drawCacheChunkSize)*(this.width/this.drawCacheChunkSize),r=this.chunks[i];null!=r&&(d(null!==this.chunkPool),this.chunkPool.release(r),this.chunks[i]=null)},e}(Ge),He=!1,Ke=null,Qe=[],Je=!1;function Ze(t){!1!==t&&"string"!=typeof Ke&&(Ke=t)}function $e(t){if(!He)throw Error("Brass must be initialized before ".concat(t,"; Run Brass.init()"))}function ti(){if(jt()){var t=deltaTime;t=Math.min(Ve,t);var e=function(t){var e=0;for(;Qe.length>0;){var i=Math.min(t,Qe[0].duration);if(t-=i,e+=i*Qe[0].rate,Qe[0].duration-=i,!(Qe[0].duration<=0))break;Qe.shift()}return function(t){Gt+=t}(e+=t),e}(t=Math.max(Ye,t));ei(),void 0!==Ue.brassUpdate&&Ue.brassUpdate(e),ii(e),void 0!==Ue.brassDraw&&(ot(),Ue.brassDraw(e))}else le()}function ei(){qt(),function(){var t,e,i,r,n,o,a,s,l=navigator.getGamepads();try{for(var u=h(l),c=u.next();!c.done;c=u.next()){var d=c.value;if(d)try{for(var f=(i=void 0,h(F)),p=f.next();!p.done;p=f.next()){var y=p.value;y.user&&y.gamepad&&y.gamepad.index===d.index&&(y.gamepad=d,y.user.gamepad=d)}}catch(t){i={error:t}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}try{for(var v=h(R.values()),g=v.next();!g.done;g=v.next())g.value.update()}catch(t){n={error:t}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}try{for(var m=h(j),w=m.next();!w.done;w=m.next())w.value.update()}catch(t){a={error:t}}finally{try{w&&!w.done&&(s=m.return)&&s.call(m)}finally{if(a)throw a.error}}}()}function ii(t){$e("updating Brass"),Je&&function(t){var e,i;Le("updating physics"),null===Pe&&(Pe=t),0!==Pe&&Matter.Engine.update(be,t,t/Pe),Pe=t;try{for(var r=h(Te.entries()),n=r.next();!n.done;n=r.next()){var o=l(n.value,2),a=(o[0],o[1]),s=a.cast(t),u=s.body,c=s.point;a.position=c.copy(),u&&(a.triggerSensors({body:u,self:a,points:[c]}),a.kill())}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}}(t),function(t){var e,i;try{for(var r=h(Qt),n=r.next();!n.done;n=r.next())n.value.update(t)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}}(t),function(){var t,e;try{for(var i=h(Ne),r=i.next();!r.done;r=i.next())r.value.maintain()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}}(),function(){for(var t=Kt()+3,e=me+ge.length,i=me;i<e;i++){var r=i%ge.length;if(me=(i+1)%ge.length,ge[r].update(t),Kt()>t)return}}(),de(t)}window.addEventListener("load",(function(){window.addEventListener("error",(function(t){return Ze(t.message)}))}));var ri=function(){function t(t){var e,i,r;void 0===t&&(t={}),this.lightMap=new pt,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:.25,this._blur=null!==(i=t.blur)&&void 0!==i?i:1,this.color=null!==(r=t.color)&&void 0!==r?r:p(255)}return t.prototype.begin=function(t,e){void 0===t&&(t=Zt()),void 0===e&&(e=it("defaultP5")),this.lightMap.sizeMaps(e.getSize(this.resolution)),this.resetLightMap();var i=t.scale;return t.scale*=this.resolution,t.view(e),t.scale=i,this},t.prototype.end=function(t){void 0===t&&(t=it("defaultP5"));var e=t.getMaps().canvas;e.push(),e.resetMatrix(),e.blendMode(MULTIPLY),e.image(this.getLightCanvas(),0,0,width,height),e.pop()},Object.defineProperty(t.prototype,"blur",{get:function(){return this._blur},set:function(t){this._blur=t,this.fill(this.color)},enumerable:!1,configurable:!0}),t.prototype.fill=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.getLightCanvas(),r=p.apply(void 0,u([],l(t),!1));if(i.fill(r),this._blur>0){var n=red(r),o=green(r),a=blue(r);i.stroke(n/2,o/2,a/2),i.strokeWeight(this._blur)}else i.noStroke();return this.color=r,this},t.prototype.point=function(t,e,i){return this.getLightCanvas().circle(t,e,2*i),this},t.prototype.cone=function(t,e,i,r,n){return void 0===r&&(r=HALF_PI),void 0===n&&(n=1e3),this.getLightCanvas().triangle(t,e,t+Math.cos(i-r/2)*n,e+Math.sin(i-r/2)*n,t+Math.cos(i+r/2)*n,e+Math.sin(i+r/2)*n),this},t.prototype.world=function(){return this.getLightCanvas().background(this.color),this},t.prototype.resetLightMap=function(){var t=this.getLightCanvas();t.push(),t.blendMode(BLEND),t.background(0),t.pop(),t.resetMatrix()},t.prototype.getLightCanvas=function(){if(!this.lightMap.hasSize())throw Error("Lighter.begin() must be ran before using lighting");return this.lightMap.getMaps().canvas},t}();return t.AStarPathfinder=Me,t.CanvasDrawTarget=vt,t.CircleBody=Oe,t.ClassicViewpoint=ne,t.DrawTarget=ft,t.GridBody=Ie,t.Heap=w,t.InputMapper=H,t.MappedHeap=b,t.MappedMaxHeap=C,t.MappedMinHeap=M,t.MaxHeap=x,t.MinHeap=S,t.P5DrawTarget=yt,t.P5Lighter=ri,t.P5Tilemap=qe,t.ParticleAbstract=ye,t.PolyBody=Fe,t.RayBody=We,t.RectBody=je,t.Vector2=E,t.Vector3=A,t.VelocityParticleAbstract=ve,t.Viewpoint=oe,t.disableContextMenu=function(){window.addEventListener("contextmenu",(function(t){return t.preventDefault()}))},t.displayRegl=function(t){void 0===t&&(t=it("defaultP5")),at();var e=t.getMaps().canvas,i=rt("defaultRegl").getMaps().canvas;e.drawingContext.drawImage(i,0,0,e.width,e.height)},t.drawColliders=function(t,e){var i,r,n,o;void 0===t&&(t=.5),void 0===e&&(e=it("defaultP5"));var a=e.getMaps().canvas;a.push(),a.noFill(),a.stroke(0,255,0),a.strokeWeight(t);for(var s=u([],l(xe.bodies),!1),c=new Set(s.map((function(t){return t.id})));s.length>0;){var d=s.pop();try{for(var f=(i=void 0,h(d.parts)),p=f.next();!p.done;p=f.next()){var y=p.value;c.has(y.id)||(s.push(y),c.add(y.id))}}catch(t){i={error:t}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}a.beginShape();try{for(var v=(n=void 0,h(d.vertices)),g=v.next();!g.done;g=v.next()){var m=g.value;a.vertex(m.x/Se,m.y/Se)}}catch(t){n={error:t}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}a.endShape(CLOSE)}a.pop()},t.drawFPS=function(t){void 0===t&&(t=it("defaultP5"));var e=t.getMaps().canvas;e.push(),e.resetMatrix(),e.stroke(0),e.fill(0,127),e.rect(5.5,5.5,140,70),e.noStroke(),e.fill(0,127),e.rect(10.5,10.5,59,60);var i=ae,r=frameRate();r>0&&i.push(r),i.length>30&&i.shift();var n=1/0,o=0,a=-1/0;e.noStroke();for(var s=0;s<i.length;s++){var h=i[s];n=Math.min(h,n),o+=h,a=Math.max(h,a),h>45?e.fill(0,220,0):h>=22.5?e.fill(255,255,0):e.fill(255,0,0),e.rect(10+2*s,70-h,2,h)}o/=i.length,i.length>0&&(e.textSize(12),e.textAlign(LEFT,TOP),e.fill(255),e.noStroke(),e.text("Min: ".concat(n.toPrecision(3)),82,13),e.text("Avg: ".concat(o.toPrecision(3)),81,28),e.text("Max: ".concat(a.toPrecision(3)),79,43),e.text("Now: ".concat(r.toPrecision(3)),78,58)),e.pop()},t.drawLoading=le,t.drawParticles=function(t,e){var i,r;void 0===t&&(t=Zt()),void 0===e&&(e=it("defaultP5"));var n=e.getMaps().canvas,o=t.getViewArea(e);try{for(var a=h(ue.entries()),s=a.next();!s.done;s=a.next()){var u=l(s.value,2),c=(u[0],u[1]),d=c.position.x+c.radius>o.minX&&c.position.x-c.radius<o.maxX,f=c.position.y+c.radius>o.minY&&c.position.y-c.radius<o.maxY;d&&f&&(n.push(),n.translate(c.position.x,c.position.y),n.scale(c.radius),c.draw(n),n.pop())}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}},t.emit=function(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var o=ue.size/ce;for(e*=Math.max(.1,1-Math.pow(.9*o,6));e>1||e>Math.random();)fe(t,i,r),e--},t.emitSingle=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=ue.size/ce;n>1&&n>1+Math.random()||fe(t,e,i)},t.enableUnsafeWorldLoading=function(){zt=!0},t.getCanvasDrawTarget=rt,t.getDefaultViewpoint=Zt,t.getDrawTarget=tt,t.getExactTime=Kt,t.getImage=function(t){At("getting images");var e=xt[t];return e||mt},t.getP5DrawTarget=it,t.getRegl=at,t.getSimTime=function(){return Gt},t.getSound=function(t){At("getting sounds"),function(t){if(!0!==Ct)throw Error("Sound must enabled in Brass.init() before ".concat(t))}("getting sounds");var e=xt[t];return null!=e?e:wt},t.getTestStatus=function(){return Ke},t.getTime=Ht,t.getTimewarp=function(){return 0===Qe.length?{duration:1/0,rate:1}:Qe[0]},t.getTimewarps=function(){return Qe},t.getWorld=function(t){At("getting worlds");var e=xt[t];return null!=e?e:null},t.hasDrawTarget=et,t.init=function(t){var e,i,n,o,a,s;if(void 0===t&&(t={}),void 0===t.sound&&void 0!==r.default.SoundFile&&console.warn("p5.sound.js has been found; Enable or disable sound in Brass.init()"),void 0===t.matter&&void 0!==globalThis.Matter&&console.warn("matter.js has been found; Enable or disable matter in Brass.init()"),void 0===t.regl&&void 0!==globalThis.createREGL&&console.warn("regl.js has been found; Enable or disable regl in Brass.init()"),t.sketch)Ue=t.sketch;else{if(!("p5"in globalThis))throw Error("Can't find p5.js, it is required for Brass");if(!("setup"in globalThis))throw Error("Can't seem to find p5; If you are running in instance mode pass the sketch into Brass.init()");Ue=globalThis}Ue.disableFriendlyErrors=!0,window.addEventListener("gamepadconnected",I),window.addEventListener("gamepaddisconnected",_),O.set("movement",(function(t){var e=new E;t.has("keyboard")&&((t.button.get("keyboardS")||t.button.get("keyboardArrowDown"))&&e.addScalar(0,1),(t.button.get("keyboardA")||t.button.get("keyboardArrowLeft"))&&e.addScalar(-1,0),(t.button.get("keyboardD")||t.button.get("keyboardArrowRight"))&&e.addScalar(1,0),(t.button.get("keyboardW")||t.button.get("keyboardArrowUp"))&&e.addScalar(0,-1),e.mag>0&&e.norm(1)),t.has("gamepad")&&(t.button.get("gamepadDpadDown")&&e.addScalar(0,1),t.button.get("gamepadDpadLeft")&&e.addScalar(-1,0),t.button.get("gamepadDpadRight")&&e.addScalar(1,0),t.button.get("gamepadDpadUp")&&e.addScalar(0,-1),e.mag>0?e.norm(1):e.set(t.vector.get("gamepadStickLeft"))),t.vector.setSafe("movement",e)})),O.set("actionA",(function(t){var e=!1;t.has("keyboard")&&(e||(e=t.button.get("keyboardE")),e||(e=t.button.get("keyboardShiftLeft"))),t.has("mouse")&&(e||(e=t.button.get("mouseLeft"))),t.has("gamepad")&&(e||(e=t.button.get("gamepadFaceRight"))),t.button.setSafe("actionA",e)})),O.set("actionB",(function(t){var e=!1;t.has("keyboard")&&(e||(e=t.button.get("keyboardQ")),e||(e=t.button.get("keyboardR")),e||(e=t.button.get("keyboardF"))),t.has("mouse")&&(e||(e=t.button.get("mouseRight"))),t.has("gamepad")&&(e||(e=t.button.get("gamepadFaceDown"))),t.button.setSafe("actionB",e)})),O.set("actionC",(function(t){var e=!1;t.has("keyboard")&&(e||(e=t.button.get("keyboardSpace"))),t.has("mouse")&&(e||(e=t.button.get("mouseCenter"))),t.has("gamepad")&&(e||(e=t.button.get("gamepadFaceUp")),e||(e=t.button.get("gamepadFaceLeft"))),t.button.setSafe("actionC",e)})),Z(Ue,null!==(e=t.regl)&&void 0!==e&&e,t.drawTarget),Jt(void 0===(s=t.viewpoint)?new ne(1,new E(0,0)):s);var h=Math.min(_targetFrameRate,null!==(i=t.maxFrameRate)&&void 0!==i?i:60);Ue.frameRate(h),Xe=1e3/h,Ve=null!==(n=t.maxTimeDelta)&&void 0!==n?n:2*Xe,Ye=null!==(o=t.minTimeDelta)&&void 0!==o?o:.5*Xe,qt(),function(t){if(Ct=t,(mt=y(64,64)).background(0),mt.fill(255,0,255),mt.noStroke(),mt.rect(0,0,32,32),mt.rect(32,32,32,32),Ct){wt=new r.default.SoundFile;var e=getAudioContext(),i=new Array(11025).fill(0).map((function(t,e){return Math.sin(.356*e)})),n=e.createBuffer(1,i.length,44100);n.getChannelData(0).set(i),wt.buffer=n,wt.panner.inputChannels(n.numberOfChannels)}Mt=!0,Lt()}(null!==(a=t.sound)&&void 0!==a&&a),(Je=void 0!==t.matter)&&("object"==typeof t.matter?Ae(t.matter):Ae()),void 0===Ue.draw&&(Ue.draw=ti),void 0===Ue.windowResized&&(Ue.windowResized=function(){return nt()}),He=!0},t.loadImageDynamic=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=Vt(ut.Image,e);if("number"==typeof t){if(t<2||t>5)throw Error("expected 2 to 5 dynamic image quality steps, found (".concat(t,")"));t=["_FULL","_HALF","_QUARTER","_EIGHTH","_SIXTEENTH"].slice(0,t)}var n=Ft(t,r).promises;return n},t.loadImageEarly=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Vt(ut.Image,t),r=i.name,n=i.fullPath;return Nt(n,r,loadImage)},t.loadImageLate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Vt(ut.Image,t),r=i.name,n=i.fullPath;return Ut({type:ut.Image,path:n,names:[r],late:!0,children:[]})},t.loadProgress=Ot,t.loadSoundEarly=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Vt(ut.Sound,t),r=i.name,n=i.fullPath;return It(),Nt(n,r,loadSound)},t.loadSoundLate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Vt(ut.Sound,t),r=i.name,n=i.fullPath;return It(),Ut({type:ut.Sound,path:n,names:[r],late:!0,children:[]})},t.loadWorldEarly=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=Vt(ut.World,e),n=r.name,o=r.fullPath;return new Promise((function(e,i){loadJSON(o,(function(i){var r=_t(t,i);xt[n]=r,e(r)}),i)}))},t.loadWorldLate=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=Vt(ut.World,e),n=r.name,o=r.fullPath;return Ut({type:ut.World,path:o,names:[n],late:!0,children:[],fields:t})},t.loaded=jt,t.refreshRegl=function(){at()._refresh()},t.refreshReglFast=st,t.resize=nt,t.setDefaultViewpoint=Jt,t.setDrawTarget=$,t.setLoadingTips=se,t.setParticleLimit=function(t){ce=t},t.setTestStatus=Ze,t.timewarp=function(t,e){void 0===e&&(e=0),Qe.push({duration:t,rate:e})},t.update=function(t){void 0===t&&(t=deltaTime),$e("updating Brass"),ei(),ii(t)},t.watchVector=B,Object.defineProperty(t,"__esModule",{value:!0}),t}({},p5);
